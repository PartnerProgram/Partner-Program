<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Recast Partner Program – Branded Preview</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <script src="https://unpkg.com/lucide@latest"></script>
  </head>
  <body class="bg-[#f9fafb] text-[#111827] font-['Inter',sans-serif] min-h-screen">
    <header class="relative overflow-hidden">
      <div aria-hidden="true" class="pointer-events-none absolute inset-0 blur-3xl"
           style="background:
             radial-gradient(60% 60% at 20% 10%, rgba(37,99,235,0.18) 0%, transparent 70%),
             radial-gradient(60% 60% at 80% 0%, rgba(37,99,235,0.18) 0%, transparent 70%),
             radial-gradient(80% 80% at 50% 90%, rgba(37,99,235,0.1) 0%, transparent 70%)">
      </div>
      <div class="relative mx-auto max-w-7xl px-6 lg:px-12 pt-10 pb-8">
        <div class="flex items-center justify-between">
          <div class="inline-flex items-center gap-2 rounded-full border border-[#E2E8F0] bg-white px-3 py-1 text-xs text-gray-600">
            <span class="inline-block h-1.5 w-1.5 rounded-full bg-[#2563eb]" aria-hidden="true"></span>
            <span class="sr-only">Recast Partner Program</span>
          </div>
        </div>
        <h1 class="mt-4 text-3xl font-semibold leading-tight sm:text-4xl">
          <span class="text-transparent bg-clip-text"
                style="background-image: linear-gradient(90deg, #2563eb, #1d4ed8);">Recast Partner Program</span>
        </h1>
        <p class="mt-2 max-w-3xl text-gray-700 leading-relaxed">
          We put <span class="text-[#2563eb] font-semibold">partnership</span> at the center of how we go to market.
        </p>
      </div>
    </header>
    <main class="relative mx-auto max-w-7xl px-6 lg:px-12 pb-20">
      <div id="app"></div>
    </main>
    <script>
      const STATE = {
        partnerType: 'Premier',
        commitment: 'Annual',
        dealType: 'Net New',
        newPartner: false,
        activeTab: 'overview',
        showBusinessPlanModal: false,
        showEvaluationModal: false,
        showPartnerEventsModal: false,
        showCsvModal: false,
        activeStep: 0,
        band: 'band1',
        roeView: 'partner', // 'partner' | 'internal'
        defaultBandByType: { Registered:'band3', Preferred:'band2', Premier:'band1', MSP:'band1' },
        partnerTierMeta: {
          'Registered': {
            defaultBand: 'band3',
            marginCap: '5%',
            coSellEligible: false,
            fullCycleEligible: false,
          },
          'Preferred': {
            defaultBand: 'band2',
            marginCap: '15%',
            coSellEligible: true,
            fullCycleEligible: false,
          },
          'Premier': {
            defaultBand: 'band1',
            marginCap: '30%',
            coSellEligible: true,
            fullCycleEligible: true,
          },
          'MSP': {
            defaultBand: 'band1',
            marginCap: '30%',
            coSellEligible: true,
            fullCycleEligible: true,
          },
        },
        simpleROE: {
          Registered: {
            summary: "You can refer and transact. Margin capped at 5% for transactional or referral sales only.",
            sourcing: [
              {label:"Partner Sourced", value:"You found the opp + registered it → Up to 5% if approved."},
              {label:"Transactional/Referral", value:"Intro or PO only → Referral margin."}
            ],
            bands: [
              {band:"Band 3 – Transactional", when:["Intro only or PO processing"], rule:"Default for LAR/Referral"}
            ],
            renewals:[
              "Renewal margin is discretionary, capped at 5%, and applies only if the LAR manages the renewal process.",
            ],
            roePrinciples: [
              {principle:"Deal Registration", description:"Required only when Recast requests it for transactional tracking.", intent:"Maintain visibility into reseller-led renewals and SKUs."},
              {principle:"Partner of Record", description:"Applies on approved transactions only; expires automatically at renewal unless partner remains active.", intent:"Simplify transactional flow; no lifetime PoR."},
              {principle:"Sales Collaboration", description:"Optional; Recast leads the sale, LAR supports quote and PO process.", intent:"Maintain message control and accuracy."},
              {principle:"Renewal Ownership", description:"Renewal margin is discretionary, capped at 5%, and applies only if the LAR manages the renewal process.", intent:"Protect margin integrity and ensure customer experience consistency."},
            ],
            marginBands: [
              {band:"Band 3 – Transactional / Referral", criteria:"Partner identifies or processes transaction. Recast leads sales cycle and closes opportunity.", eligible:"Registered (LAR/Referral)", margin:"5% (Discretionary)", example:"LAR adds Recast SKU to renewal with minimal engagement."},
            ],
            csv: {
              blurb:"Upload event or campaign lists for fast routing. Influence ≠ margin.",
              required:["Partner Name","Campaign Name/ID","Account Name (and Domain)","First Name","Last Name","Email","Country","Source Type","Attribution Intent","Requested PoR (Y/N)"],
              flow:[
                "Create/Update Campaign Members; de-dupe by email; match Account by Domain/Name.",
                "Stamp: Lead Source=Partner Event; Sourcing Partner; Attribution (Primary/Influence).",
                "Option: 'Create Deal Registration' → PQL → Channel approval in 2 business days."
              ]
            }
          },
          Preferred: {
            summary:"You co-sell with us; consistent activity earns Band 2. Own full cycle → Band 1.",
            sourcing: [
              {label:"Partner Sourced", value:"You found the opp + registered it + helped close → Full margin when you drive the sale."},
              {label:"Recast Sourced (Co-Sell)", value:"We brought the lead; you help sell → Shared margin."},
              {label:"Transactional/Referral", value:"Intro or PO only → Referral margin."}
            ],
            bands:[
              {band:"Band 1 – Full-Cycle", when:["Sourced + registered","Owns qual→close with light Recast support"], rule:"Full margin"},
              {band:"Band 2 – Co-Sell", when:["Shared discovery/demo/pricing; active MAP"], rule:"Shared margin"}
            ],
            renewals:["PoR retains renewal with activity compliance; else may be reassigned."],
            csv: {
              blurb:"Upload event or campaign lists for fast routing. Influence ≠ margin.",
              required:["Partner Name","Campaign Name/ID","Account Name (and Domain)","First Name","Last Name","Email","Country","Source Type","Attribution Intent","Requested PoR (Y/N)"],
              flow:[
                "Create/Update Campaign Members; de-dupe by email; match Account by Domain/Name.",
                "Stamp: Lead Source=Partner Event; Sourcing Partner; Attribution (Primary/Influence).",
                "Option: 'Create Deal Registration' → PQL → Channel approval in 2 business days."
              ]
            }
          },
          Premier: {
            summary:"Strategic partner. Default expectation is Band 1 unless co-sell is requested.",
            sourcing: [
              {label:"Partner Sourced", value:"You found the opp + registered it + helped close → Full margin when you drive the sale."},
              {label:"Recast Sourced (Co-Sell)", value:"We brought the lead; you help sell → Shared margin."},
              {label:"Transactional/Referral", value:"Intro or PO only → Referral margin."}
            ],
            bands:[
              {band:"Band 1 – Full-Cycle", when:["Sourced + end-to-end ownership"], rule:"Full margin"},
              {band:"Band 2 – Co-Sell", when:["Recast Sourced or heavier presales help"], rule:"Shared margin"}
            ],
            renewals:["PoR renewal protection with activity; expansions follow Bands."],
            csv: {
              blurb:"Upload event or campaign lists for fast routing. Influence ≠ margin.",
              required:["Partner Name","Campaign Name/ID","Account Name (and Domain)","First Name","Last Name","Email","Country","Source Type","Attribution Intent","Requested PoR (Y/N)"],
              flow:[
                "Create/Update Campaign Members; de-dupe by email; match Account by Domain/Name.",
                "Stamp: Lead Source=Partner Event; Sourcing Partner; Attribution (Primary/Influence).",
                "Option: 'Create Deal Registration' → PQL → Channel approval in 2 business days."
              ]
            }
          },
          MSP: {
            summary:"Managed service delivery; monthly economics; PoR protections per MSP ROE.",
            sourcing:[{label:"MSP Motion", value:"You package Recast in services; co-sell on net-new logos."}],
            bands:[
              {band:"Band 1", when:["MSP drives sale and delivery"], rule:"Programmed in MSP price book"},
              {band:"Band 2", when:["Co-sell with Recast SE/AE"], rule:"Shared margin"}
            ],
            renewals:["Incumbent MSP retains renewal if active in lifecycle reviews."],
            csv: {
              blurb:"Upload event or campaign lists for fast routing. Influence ≠ margin. Emphasize multitenant lists.",
              required:["Partner Name","Campaign Name/ID","Account Name (and Domain)","First Name","Last Name","Email","Country","Source Type","Attribution Intent","Requested PoR (Y/N)"],
              flow:[
                "Create/Update Campaign Members; de-dupe by email; match Account by Domain/Name.",
                "Stamp: Lead Source=Partner Event; Sourcing Partner; Attribution (Primary/Influence).",
                "Option: 'Create Deal Registration' → PQL → Channel approval in 2 business days."
              ]
            }
          }
        },
        exampleACV: 100000,
        servicesMultiplier: 6, // New: 6:1 ratio for services
        salesCycle: {
          stages: {
            PQL: {
              label: "PQL",
              description: "Partner Qualified Lead registered in portal. Recast approval is required to assign Partner of Record.",
              entryCriteria: ["Partner identifies lead", "Lead submitted in Partner Portal"],
              exitCriteria: ["Recast approves or declines within SLA", "Partner of Record set in CRM"],
              deliverables: ["Registration form (company, domain, contacts, use case)", "Approval notification"],
            },
            Identification: {
              label: "Identification (10% Pipeline)",
              description: "Initial contact made; meeting confirmed; problem identified.",
              entryCriteria: ["Approved lead", "Intro outreach completed"],
              exitCriteria: ["Discovery meeting held", "Clear problem statement"],
              deliverables: ["Discovery notes", "Next-step email / agenda"],
            },
            Qualification: {
              label: "Qualification (25% Pipeline)",
              description: "Pain and decision process validated; budget signal present; technical feasibility confirmed.",
              entryCriteria: ["Engaged prospect", "Business + technical discovery"],
              exitCriteria: ["Budget/timeline/authority captured", "Technical viability confirmed"],
              deliverables: ["MEDDICC summary", "Qualified Opportunity in CRM"],
            },
            Development: {
              label: "Development (50% Best Case)",
              description: "Solutioning and validation; business case and compelling event linked to value.",
              entryCriteria: ["Technical work started", "Solution fit agreed"],
              exitCriteria: ["Technical Win achieved", "Budget allocated"],
              deliverables: ["Technical validation checklist", "Mutual Action Plan (MAP)", "High-level architecture / scope"],
            },
            Proposal: {
              label: "Proposal (75% Best Case)",
              description: "Commercial alignment; quote/SOW delivered; legal/security reviews in progress.",
              entryCriteria: ["Budget identified", "Solution design accepted"],
              exitCriteria: ["Budget approval in progress", "Security/Legal submitted"],
              deliverables: ["Final quote or SOW", "Security questionnaire / DPA (if required)"],
            },
            Closing: {
              label: "Closing (90% Commit)",
              description: "Signature or PO routing; go-live plan established.",
              entryCriteria: ["Commercial terms finalized", "Redlines near completion"],
              exitCriteria: ["Signature/PO received", "Launch date confirmed"],
              deliverables: ["Executed order form/PO", "Launch plan"],
            },
            ClosedWon: {
              label: "Closed Won (100% Closed)",
              description: "Provisioning and fulfillment completed; CS intro scheduled.",
              entryCriteria: ["Executed paperwork"],
              exitCriteria: ["Software/license delivered", "CS kickoff scheduled"],
              deliverables: ["Fulfillment confirmation", "Handoff note to CS"],
            },
            Onboarding: {
              label: "Onboarding",
              description: "Kickoff → Implementation → UAT → Launch → Enablement; drive time-to-value and adoption.",
              entryCriteria: ["Closed-won handoff"],
              exitCriteria: ["Go-live achieved", "Enablement milestones completed"],
              deliverables: ["Kickoff deck", "Implementation checklist", "UAT sign-off", "Training/Certification path"],
            },
          },
          bandMeta: {
            band1: {
              name: "Band 1 – Full-Cycle Ownership",
              summary: "Partner leads end-to-end (lead → close). Recast provides SMEs as needed.",
              margin: "30%",
              color: "bg-green-100 text-green-800",
            },
            band2: {
              name: "Band 2 – Joint Engagement",
              summary: "Co-sell motion. Partner drives top/mid-funnel; Recast supports validation and close.",
              margin: "15%",
              color: "bg-amber-100 text-amber-800",
            },
            band3: {
              name: "Band 3 – Transactional / Referral",
              summary: "Partner sources or influences; Recast runs the sale.",
              margin: "5% (discretionary)",
              color: "bg-slate-200 text-slate-800",
            },
          },
          bands: {
            band1: {
              PQL: { primaryOwner: "Partner AE", support: ["Recast Channel Manager"], accountable: "Recast Channel Manager" },
              Identification: { primaryOwner: "Partner AE", support: ["Recast AE"], accountable: "Partner Sales Lead" },
              Qualification: { primaryOwner: "Partner AE", support: ["Partner SE"], accountable: "Partner Sales Lead" },
              Development: { primaryOwner: "Partner SE", support: ["Recast SE (as-needed)", "Partner AE"], accountable: "Partner SE Lead" },
              Proposal: { primaryOwner: "Partner AE", support: ["Partner SE", "Recast AE (pricing review)", "Recast Legal/Security (as-needed)"], accountable: "Partner Sales Lead" },
              Closing: { primaryOwner: "Partner AE", support: ["Recast AE", "Channel Ops"], accountable: "Partner Sales Lead" },
              ClosedWon: { primaryOwner: "Partner AE", support: ["Recast AE", "Recast CS"], accountable: "Recast Sales Leader" },
              Onboarding: { primaryOwner: "Partner Services", support: ["Recast CS", "Partner PM"], accountable: "Recast CS Leader" },
            },
            band2: {
              PQL: { primaryOwner: "Partner AE", support: ["Recast Channel Manager"], accountable: "Recast Channel Manager" },
              Identification: { primaryOwner: "Partner AE", support: ["Recast AE"], accountable: "Recast AE" },
              Qualification: { primaryOwner: "Partner AE", support: ["Recast SE"], accountable: "Recast AE" },
              Development: { primaryOwner: "Recast SE", support: ["Partner SE", "Partner AE"], accountable: "Recast SE Lead" },
              Proposal: { primaryOwner: "Recast AE", support: ["Partner AE", "Recast Legal/Security"], accountable: "Recast Sales Leader" },
              Closing: { primaryOwner: "Recast AE", support: ["Partner AE", "Channel Ops"], accountable: "Recast Sales Leader" },
              ClosedWon: { primaryOwner: "Recast AE", support: ["Recast CS", "Partner AE"], accountable: "Recast Sales Leader" },
              Onboarding: { primaryOwner: "Recast CS", support: ["Partner Services"], accountable: "Recast CS Leader" },
            },
            band3: {
              PQL: { primaryOwner: "Recast AE / Channel Manager", support: ["Partner (Referral / LAR)"], accountable: "Recast Channel Manager" },
              Identification: { primaryOwner: "Recast AE", support: ["Partner (Intro only)"], accountable: "Recast AE" },
              Qualification: { primaryOwner: "Recast AE", support: ["Recast SE"], accountable: "Recast AE" },
              Development: { primaryOwner: "Recast SE", support: ["Recast AE"], accountable: "Recast SE Lead" },
              Proposal: { primaryOwner: "Recast AE", support: ["Legal/Security", "Finance"], accountable: "Recast Sales Leader" },
              Closing: { primaryOwner: "Recast AE", support: ["Channel Ops"], accountable: "Recast Sales Leader" },
              ClosedWon: { primaryOwner: "Recast AE", support: ["CS"], accountable: "Recast Sales Leader" },
              Onboarding: { primaryOwner: "Recast CS", support: ["Partner (as applicable)"], accountable: "Recast CS Leader" },
            },
          },
          rows: ["PQL", "Identification", "Qualification", "Development", "Proposal", "Closing", "ClosedWon", "Onboarding"],
        },
        msp: {
          overview: "Welcome to the Recast MSP Partner Program\n\nThe Recast MSP Program is built for service providers that want to embed Recast’s solutions into their service offerings to drive recurring revenue, expand client value, and scale with predictable economics.\n\nWe support multiple MSP archetypes—from infra-focused to app-centric—with enablement tailored to each type. Whether you’re a high-touch implementation shop or a lightweight automation-led MSP, this program offers flexible models to fit your business.\n\nProgram Highlights:\n\n* Monthly point-based licensing structure for easy cost forecasting\n\n* Tiered margin bands based on deal ownership and engagement\n\n* Access to white-labeled deployment kits, SOWs, and enablement tools\n\n* Support for both application workspace and endpoint solutions\n\n* Designed to protect partner margin, loyalty, and renewal rights",
          requirements: [
            "Invitation and approval from Recast Channel Leadership",
            "Executed Master Partner or OEM Agreement",
            "Active go-to-market motion and enablement plan on file",
            "Quarterly alignment on co-sell activity or pipeline reviews (QBRs)",
            "Minimum monthly point commitment (entry tier: 300 points/month)",
            "Completion of required certifications for eligible product lines",
            "Agreement to Rules of Engagement and margin structure"
          ],
          benefits: [
            "Registered deal margin (per Band definition)",
            "Renewal margin protection with activity compliance",
            "Monthly point-based pricing tiers with discounted rates at scale",
            "Recast partner portal access",
            "Prebuilt “Campaigns-in-a-Box” and brand kits",
            "Partner services packaging playbooks (SOWs, pricing templates)",
            "Self-service training and deployment kits",
            "Joint lead-gen campaigns and MDF eligibility (tier-based)",
            "Dedicated partner support lines for sales, SE, and services",
            "Recast Account Manager for joint planning",
            "Eligibility for Recast-sourced leads (with active plan and certs)"
          ],
          onboarding: {
            steps: [
              "Partner invitation and agreement execution",
              "Assign internal Partner Sales Lead and Technical Lead",
              "Complete initial certification (sales + technical track)",
              "Define GTM and enablement plan with Recast Channel Manager",
              "Select monthly point commitment tier",
              "Gain access to:\n * Partner Portal\n * Deployment and packaging toolkits\n * Sales motion playbooks\n * Points-based pricing calculator",
              "Launch your first co-sell or registered opportunity",
              "Schedule first Quarterly Business Review (QBR)"
            ],
            resources: [
              "New Partner Starter Kit",
              "Certification path guides",
              "Pricing and packaging calculator",
              "Application Workspace and Right Click Tool playbooks",
              "Partner FAQ and escalation contact list"
            ]
          },
          roe: [
            "Deal Registration is Mandatory\nAll partner-led opportunities must be registered and approved in the Partner Portal to qualify for margin and Partner of Record (PoR) status.",
            "Partner of Record (PoR) Protection\nApproved PoR partners retain rights for the full customer lifecycle, including renewals and expansions, provided they maintain active engagement (e.g., QBRs, renewal activity).",
            "Discount Policy\nRecast will not discount or quote any PoR-owned customer below partner pricing unless pre-approved through a formal channel escalation.",
            "Conflict Resolution\nIn overlapping claims, Recast Channel Leadership will evaluate based on:\n* Deal registration timestamp\n* CRM activity log\n* Customer attestation (if needed)",
            "Renewal Ownership\nPartner of Record retains renewal margin unless:\n* Customer explicitly reassigns to another partner\n* Partner has been inactive and missed renewal planning window",
            "Sales Collaboration\nRequirements vary by Band:\n* Band 1: partner-driven\n* Band 2: co-sell required\n* Band 3: Recast-owned",
            "Ethical Conduct\nAll partners must comply with Recast’s Code of Conduct, anti-poaching rules, and maintain professional behavior in joint accounts.",
            "Margin Band Enforcement\n* Bands 1–3 define margin eligibility\n* Margins reset if Band criteria are not met\n* Quarterly review of Band performance and partner tiering",
            "Governance\n* Lead registration valid for 30 days; can be renewed with pipeline activity\n* Band reviews occur quarterly\n* Escalation SLA: 5 business days to VP of Partner Programs"
          ]
        },
        model: {
          tiers: {
            Registered: {
              overview: "Registered partners are either License Added Resellers (LARs) or referral partners who help Recast reach more customers.\n\n* LARs handle the transaction — they place the order and act as the bill-to on behalf of the customer. They earn up to a 5% margin on those deals.\n\n* Referral partners introduce Recast to a customer or opportunity. If we close the deal directly, they can receive up to a 5% rebate at Recast’s discretion.\n\nThese partnerships are lightweight and transactional — no formal agreement is required. We simply set up the partner in Salesforce with valid billing information and process orders as needed.\nThey’re a low-overhead way for Recast to fulfill deals or expand into new opportunities through trusted local or resale partners.",
              requirements: [
                "Create Salesforce account with bill-to and finance contact",
                "No formal agreement required",
                "Optional referral registration (for lead-based rebates)",
                "May transact orders directly or receive rebate",
                "Subject to up to 5% rebate at Recast discretion"
              ],
              benefits: [
                "Margin/referral on registered closed deals",
              ],
            },
            Preferred: {
              overview: "Preferred Partners are approved resellers or referral partners who actively collaborate with Recast on qualified opportunities and co-selling motions. They are beyond transactional resale — investing time and resources to build Recast expertise, pursue certifications, and establish repeatable sales and delivery motions.\n\nThese partners typically co-sell and co-market with Recast, leveraging our technical experts and marketing resources to expand reach, accelerate deal velocity, and build early customer success stories. They are focused on the right customer segments, maintain a defined sales presence, and often represent Recast within their regional or vertical markets.\n\nPreferred Partners demonstrate early-stage commitment through pipeline creation, deal registration, and customer enablement. They receive access to enablement, marketing funds, and field collaboration to help them grow toward Premier-level engagement.\n\nPreferred Partners are in the growth phase of the Recast ecosystem — proving alignment, building capability, and showing consistent commitment to joint success.",
              requirements: [
                "Signed Partner Agreement",
                "Vetted & approved by Channel team",
                "1 Certified Sales and 1 Certified Technical resource",
                "Active pipeline with at least one registered deal per quarter",
                "Participation in enablement sessions or joint calls"
              ],
              benefits: [
                "Margin/referral on registered closed deals","Partner portal access","Self-service training",
                "Program logo package + exposure on Recastsoftware.com","Campaigns-in-a-box","Quarterly roadmap updates",
                "Partner licensing","Pipeline management tools","Field management / managed status",
                "Enhanced CRM access (e.g., quote-to-order)","Basic joint lead-gen support","Dedicated support line",
                "Dedicated MDF funds",
              ],
            },
            Premier: {
              overview: "Premier Partners are strategic, invite-only collaborators who represent Recast at the highest level of partnership. These partners have demonstrated sustained revenue growth, deep technical and sales capability, and a long-term commitment to joint business planning with Recast leadership.\n\nThey are fully enabled to co-sell, co-market, and co-deliver Recast solutions, often representing our brand in major enterprise environments. Premier Partners maintain certified technical resources, dedicated sales and marketing teams, and a defined customer base that aligns with Recast’s target markets and geographies.\n\nEach Premier Partner has a joint business plan with Recast — including shared revenue targets, annual growth goals, and investment commitments across enablement, customer adoption, and marketing execution. They also participate in roadmap reviews, quarterly business planning, and go-to-market alignment with Recast executives.\n\nPremier Partners are our most strategic alliances — delivering measurable impact through scale, shared investment, and sustained customer success across regions and verticals.",
              requirements: [
                "Invite Only Tier",
                "Invitation and signed Master Partner Agreement (MPA)",
                "Annual joint business plan with revenue or deployment targets",
                "Certified sales and technical resources",
                "Quarterly Business Reviews (QBRs)",
                "Active co-sell or co-marketing motion with Recast"
              ],
              benefits: [
                "Margin/referral on registered closed deals","Partner portal access","Self-service training",
                "Program logo package + exposure on Recastsoftware.com","Campaigns-in-a-box","Quarterly roadmap updates",
                "Partner licensing","Pipeline management tools","Field management / managed status",
                "Enhanced CRM access (e.g., quote-to-order)","Basic joint lead-gen support","Dedicated support line",
                "Dedicated MDF funds","Joint lead-gen campaigns","Partner support line",
                "Recast Account Manager cross-sell engagement",
              ],
            },
          },
          margins: {
            Annual: {
              "Net New": {
                "Preferred|Premier": [
                  { band: "Band 1", upTo: "30%", when: "Partner originated AND Partner registered AND Recast approved" },
                  { band: "Band 2", upTo: "15%", when: "Recast originated/registered AND Recast approved" },
                ],
                Registered: [
                  { band: "Band 3", upTo: "Up to 5% (discretionary)", when: "Get up 5% margin for transacting or rebated for demand gen" },
                ],
              },
              Renewal: {
                "Preferred|Premier": [
                  { band: "Band 1", upTo: "5%", when: "Partner of Record OR Incumbent" },
                  { band: "Band 2", upTo: "5%", when: "Non-incumbent" },
                ],
                Registered: [{ band: "Band 3", upTo: "0%", when: "NA" }],
              },
            },
            Monthly: {
              "Net New": {
                "Preferred|Premier": [
                  { band: "Band 1", upTo: "20%", when: "Partner originated AND Partner registered AND Recast approved" },
                  { band: "Band 2", upTo: "10%", when: "Recast originated/registered AND Recast approved" },
                ],
                Registered: [
                  { band: "Band 3", upTo: "Up to 5% (discretionary)", when: "Partner originated AND Partner registered AND Recast approved" },
                ],
              },
              Renewal: {
                "Preferred|Premier": [
                  { band: "Band 1", upTo: "5%", when: "Partner of Record OR Incumbent" },
                  { band: "Band 2", upTo: "5%", when: "Non-incumbent" },
                ],
                Registered: [{ band: "Band 3", upTo: "0%", when: "NA" }],
              },
            },
          },
          onboarding: {
            steps: [
              { name: "Onboard", items: [
                "Activate agreements & meeting cadence",
                "Install partner licenses; demo-back",
                "Technical accreditation (≥1)",
                "Sales accreditation (≥1)",
              ]},
              { name: "Activate", items: [
                "Register leads in Partner Central",
                "Use marketing resources",
                "Develop opportunities with tools & demos",
                "First deal achieved",
                "Directory listing & website promotion",
              ]},
              { name: "Accelerate", items: [
                "Marketing plan & events/webinars",
                "Create repeatable offer",
                "≥6 licensing deals annually",
                "Nominate for partner awards",
                "Drive expansions & renewals",
              ]},
            ],
          },
          roe: {
            principles: [
              { principle: "Deal Registration is Mandatory", description: "All partner-led opportunities must be registered and approved in the Recast Partner Portal to qualify for margin.", intent: "Protect partner investment in identifying and developing opportunities." },
              { principle: "Partner of Record Protection", description: "Once approved, the partner remains the Partner of Record (PoR) for the customer lifecycle, including renewals and expansions.", intent: "Reinforce long-term partner loyalty and recurring revenue visibility." },
              { principle: "Conflict Resolution", description: "In cases of overlapping claims, Recast Channel Leadership will evaluate based on deal registration timestamp, documented activity, and customer attestation.", intent: "Maintain fairness and avoid channel conflict." },
              { principle: "Sales Collaboration", description: "Partners must collaborate with Recast Sales for pricing and technical validation before final proposal submission.", intent: "Ensure consistency of messaging and technical accuracy." },
              { principle: "Ethical Conduct", description: "All partners must adhere to Recast’s Code of Conduct and anti-bribery/anti-poaching policies.", intent: "Protect the integrity of the channel ecosystem." },
              { principle: "Renewal Ownership", description: "Partner of Record retains renewal rights unless customer explicitly reassigns.", intent: "Encourage customer retention and lifecycle focus." },
            ],
            bands: [
              { band: "Band 1 – Full-Cycle Ownership", criteria: ["Partner sources and registers the lead.","Drives opportunity end-to-end (qualification → demo → close).","Requires minimal Recast sales or technical support.","Must be Preferred or Premier tier."], eligible: "Preferred, Premier", margin: "30%", example: "A Premier partner identifies an opportunity with a 1,000-user customer, performs demo, and closes deal without Recast sales involvement." },
              { band: "Band 2 – Joint Engagement", criteria: ["Partner sources or registers opportunity.","Recast supports with presales, demo, or technical validation.","Partner co-sells with Recast sales team.","Must be Preferred or Premier tier."], eligible: "Preferred, Premier", margin: "15%", example: "Partner brings opportunity but requests Recast SE to lead demo and pricing discussion." },
              { band: "Band 3 – Transactional / Referral", criteria: ["Partner identifies or influences opportunity but Recast leads sale.","No significant partner engagement beyond intro or transaction.","Typically applies to LARs, transactional resellers, or referral agents.","Margin discretionary, subject to sales approval."], eligible: "Registered, LAR, Referral", margin: "5% (discretionary)", example: "Large LAR adds Recast SKU to customer renewal, minimal engagement." },
            ],
            governance: [
              { element: "Eligibility Window", definition: "Lead & Deal registration valid for 30 days (renewable upon active pipeline evidence)." },
              { element: "Lead Pass", definition: "Partners are eligible to receive Recast-sourced leads, renewal opportunities, or services referrals only if they maintain an active business plan on file and are current on all required partner certifications." },
              { element: "Renewal Margin", definition: "Renewal margin standardized between 5%-10% based on tier eligibility unless expansion occurs (then revert to Bands)." },
              { element: "Band Review", definition: "Margin bands reviewed quarterly to align with GTM priorities." },
              { element: "Escalation Path", definition: "Channel disputes escalated to VP of Partner Programs within 5 business days." },
            ],
            summary: [
              { tier: "Premier", engagement: "Full-cycle (Band 1)", involvement: "Light-touch", range: "25–30%", notes: "Top-tier, full control of sales motion" },
              { tier: "Preferred", engagement: "Joint sale (Band 2)", involvement: "Moderate", range: "10–15%", notes: "Co-sell and presales collaboration" },
              { tier: "Registered / LAR", engagement: "Transactional (Band 3)", involvement: "Recast-led", range: "0–5%", notes: "Finder’s fee or referral incentive only." },
            ],
          },
          other: {
            overview: "",
            partnerTypesDescs: [
              "Managed Service Providers (MSPs) are strategic delivery partners who package Recast’s technology into their own managed services — helping customers manage, secure, and optimize their IT environments more efficiently.\n\nMSPs think in monthly recurring revenue (MRR) — not annual contracts. They operate on predictable, consumption-based models and need software that scales with them, not against them. Recast fits perfectly into this model by being easy to deploy, multitenant, and designed for repeatable use across clients.\n\nRather than making margin on licenses, MSPs make money on the services they deliver around the software — configuration, automation, monitoring, and continuous management. Recast helps them improve their margins by reducing manual effort, increasing client coverage, and adding high-value capabilities they can bundle into existing service offerings.\n\nFor many MSPs, Recast also opens the door to application management as a service, expanding beyond traditional infrastructure or security management into new, higher-value revenue streams.\n\nMSP partners are a key part of Recast’s ecosystem — they scale our reach, drive recurring adoption, and deliver measurable customer outcomes every month.",
              "ISV partners are technology companies that package and resell Recast as part of their broader solution, creating a stronger combined offering for customers. These partners typically embed or align Recast’s capabilities with their own platform to enhance value, accelerate sales cycles, and simplify deployment for joint customers.\n\nBy partnering with Recast, ISVs can address more customer pain points, eliminate common objections around integration or workflow gaps, and bring a ready-to-deploy joint solution to market faster.\n\nISV partners typically co-sell and co-market with Recast — leveraging joint messaging, enablement, and go-to-market programs to expand reach, build credibility, and drive new revenue.\n\nTogether, we deliver a unified, higher-value solution that helps both companies win faster, sell more efficiently, and serve customers better.",
              "OEM partners are strategic technology companies that embed Recast’s capabilities directly into their own products or platforms to enhance functionality, performance, or customer experience. These relationships extend Recast’s reach to thousands of customers through the partner’s existing technology ecosystem.\n\nIn an OEM model, the partner licenses and integrates Recast technology under their own brand, delivering it as a seamless part of their broader solution. This creates a tightly coupled, scalable go-to-market motion where Recast’s value is distributed through a trusted, established platform — accelerating adoption and expanding market penetration.\n\nOEM partnerships are highly strategic and collaborative, often involving joint engineering, product road mapping, and go-to-market alignment at both the technical and executive level.\n\nTogether, OEM partners and Recast bring enterprise-grade solutions to market faster, reduce deployment complexity for customers, and create durable, high-value revenue streams for both organizations.",
              "Distributors are territory-based partners with exclusive rights to represent and grow Recast within a defined region or market. They act as our local extension — managing partner recruitment, enablement, and demand generation to expand Recast’s reach and market share.\n\nThese partners typically maintain a network of resellers, MSPs, and system integrators in their region. They handle localized sales, billing, and first-line support, ensuring smooth customer engagement while helping Recast maintain brand and commercial consistency across markets.\n\nDistributors are responsible for developing regional pipeline, building and enabling sub-partners, and executing go-to-market plans aligned with Recast’s global objectives. They also collaborate with Recast on marketing, events, and regional channel strategy to ensure sustained partner and customer growth.\n\nThis model allows Recast to enter new markets efficiently, ensure local expertise, and scale faster through a trusted regional partner that’s fully invested in our success."
            ],
            requirements: [
              "Invitation from Recast Channel Leadership",
              "Signed Master or OEM Agreement",
              "Defined go-to-market motion and enablement plan",
              "Quarterly alignment on co-sell and marketing activities"
            ],
            partners: [
              { partnerType: "MSP", tierEligibility: "Premier", margin: "Negotiated within Band 1–3 framework", dealRegistration: "Required", mdfAccess: "Strategic MDF", enablement: "Dedicated Channel Manager, SE alignment, joint QBRs" },
              { partnerType: "Technology Partner (ISV)", tierEligibility: "Premier", margin: "Negotiated; typically Band 2 equivalent + referral incentives", dealRegistration: "Optional", mdfAccess: "Co-marketing only", enablement: "Developer enablement, API/SDK certification" },
              { partnerType: "OEM Partner", tierEligibility: "Premier", margin: "Embedded / co-sell pricing (not margin-based)", dealRegistration: "N/A", mdfAccess: "Strategic MDF", enablement: "OEM SDK, roadmap collaboration, joint solution blueprints" },
              { partnerType: "Distributor Partner", tierEligibility: "Premier", margin: "Transactional (Band 3 equivalent, pre-negotiated)", dealRegistration: "Required", mdfAccess: "Tiered MDF by volume", enablement: "Distributor onboarding toolkit, partner training delivery" },
            ]
          }
        },
        partnerEvents: {
          summaries: [
            { type: "Webinars", events: 6, avgInvited: 926, avgAttended: 853, avgOpps: 222, avgOppInvited: "24%", avgOppAttended: "26%", avgClosed: 59, win: "27%" },
            { type: "User Groups", events: 4, avgInvited: 21, avgAttended: 17, avgOpps: 4, avgOppInvited: "21%", avgOppAttended: "25%", avgClosed: 1, win: "24%" },
            { type: "Events (incl. Conf + HH)", events: 2, avgInvited: 330, avgAttended: 300, avgOpps: 85, avgOppInvited: "25%", avgOppAttended: "28%", avgClosed: 25, win: "28%" },
            { type: "Partner Events", events: 3, avgInvited: 280, avgAttended: 207, avgOpps: 52, avgOppInvited: "19%", avgOppAttended: "25%", avgClosed: 12, win: "24%" },
          ]
        },
        filterModalOpen: false,
        selectedPartnerTypes: []
      };
      const PARTNER_TYPES = ["Registered", "Preferred", "Premier", "MSP", "Technology Partner (ISV)", "OEM Partner", "Distributor Partner"];
      const TABS = [
        { id: 'overview', label: 'Overview', icon: 'book-open' },
        { id: 'requirements', label: 'Requirements & Benefits', icon: 'check-circle' },
        { id: 'onboarding', label: 'Onboarding', icon: 'rocket' },
        { id: 'salesmotion', label: 'Sales Motion', icon: 'table' },
        { id: 'margins', label: 'Margins', icon: 'dollar-sign' },
        { id: 'roe', label: 'Rules of Engagement', icon: 'gavel' }
      ];
      function initFilter() {
        STATE.selectedPartnerTypes = PARTNER_TYPES.slice();
        if (typeof localStorage !== 'undefined') {
          try {
            const saved = localStorage.getItem('recastPartnerTypeFilter');
            if (saved) {
              const parsed = JSON.parse(saved);
              STATE.selectedPartnerTypes = parsed.selectedPartnerTypes.filter(t => PARTNER_TYPES.includes(t));
            }
          } catch (e) {
            // fallback to default
          }
        }
        if (STATE.selectedPartnerTypes.length === 0) {
          STATE.selectedPartnerTypes = PARTNER_TYPES.slice();
        }
        if (!STATE.selectedPartnerTypes.includes(STATE.partnerType)) {
          STATE.partnerType = STATE.selectedPartnerTypes[0] || PARTNER_TYPES[0];
        }
      }
      function setDefaultBand(type) {
        if (type === 'Registered') return 'band3';
        if (type === 'Preferred') return 'band2';
        return 'band1';
      }
      function getPartnerData(type) {
        if (type === 'MSP') {
          return {
            overview: STATE.msp.overview,
            requirements: STATE.msp.requirements,
            benefits: STATE.msp.benefits,
            isStandard: false,
            isPremier: false,
            isPreferred: false,
            specific: STATE.model.other.partners.find(p => p.partnerType === type)
          };
        } else if (["Registered", "Preferred", "Premier"].includes(type)) {
          return {
            overview: STATE.model.tiers[type].overview,
            requirements: STATE.model.tiers[type].requirements,
            benefits: STATE.model.tiers[type].benefits,
            isStandard: true,
            isPremier: type === "Premier",
            isPreferred: type === "Preferred",
            specific: null
          };
        } else {
          const descIndex = ['MSP', 'Technology Partner (ISV)', 'OEM Partner', 'Distributor Partner'].indexOf(type);
          const desc = STATE.model.other.partnerTypesDescs[descIndex];
          return {
            overview: desc,
            requirements: STATE.model.other.requirements,
            benefits: STATE.model.tiers.Premier.benefits,
            isStandard: false,
            isPremier: false,
            isPreferred: false,
            specific: STATE.model.other.partners.find(p => p.partnerType === type)
          };
        }
      }
      function render() {
        if (!STATE.selectedPartnerTypes.includes(STATE.partnerType)) {
          STATE.partnerType = STATE.selectedPartnerTypes[0] || PARTNER_TYPES[0];
        }
        const data = getPartnerData(STATE.partnerType);
        let html = '<div class="space-y-6">';
        html += renderPartnerTypeSelector();
        html += renderTabs();
        html += '<div class="rounded-xl bg-white p-6 shadow-md hover:shadow-lg transition-shadow duration-300">';
        switch (STATE.activeTab) {
          case 'overview':
            html += renderOverview(data.overview, data.isPreferred || data.isPremier);
            break;
          case 'requirements':
            html += renderRequirementsAndBenefits(data.requirements, data.benefits, data.isPremier);
            break;
          case 'margins':
            if (data.isStandard) {
              html += renderMarginsContent();
            } else {
              html += renderDetailsContent(data.specific);
            }
            break;
          case 'roe':
            html += renderROEContent();
            break;
          case 'salesmotion':
            html += renderSalesMotionContent();
            break;
          case 'onboarding':
            if (STATE.partnerType !== 'Registered') {
              html += renderOnboardingContent(data);
            } else {
              html += '<p class="text-center text-gray-700 leading-relaxed">Not applicable for Registered partners.</p>';
            }
            break;
        }
        html += '</div>';
        html += '</div>';
        html += renderFilterTrigger();
        if (STATE.filterModalOpen) html += renderFilterModal();
        if (STATE.showBusinessPlanModal) {
          html += renderBusinessPlanModal();
        }
        if (STATE.showEvaluationModal) {
          html += renderEvaluationModal();
        }
        if (STATE.showPartnerEventsModal) {
          html += renderPartnerEventsModal();
        }
        if (STATE.showCsvModal) html += renderCsvModal();
        document.getElementById('app').innerHTML = html;
        lucide.createIcons();
        addEventListeners();
      }
      function renderFilterTrigger() {
        return `
          <div class="fixed bottom-4 left-4 z-50">
            <input type="checkbox" id="filterTrigger" class="h-4 w-4 rounded accent-[#2563eb] opacity-50 focus:opacity-100" ${STATE.filterModalOpen ? 'checked' : ''} />
          </div>
        `;
      }
      function renderFilterModal() {
        let checkboxes = '';
        PARTNER_TYPES.forEach(t => {
          const display = t === 'Registered' ? 'Registered (LAR/Referral)' : t;
          const checked = STATE.selectedPartnerTypes.includes(t) ? 'checked' : '';
          checkboxes += `
            <label class="flex items-center gap-2">
              <input type="checkbox" class="partner-type-checkbox h-4 w-4 rounded accent-[#2563eb]" data-type="${t}" ${checked} />
              ${display}
            </label>
          `;
        });
        const allChecked = STATE.selectedPartnerTypes.length === PARTNER_TYPES.length ? 'checked' : '';
        return `
          <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 px-4" role="dialog" aria-modal="true" id="filterModalBg">
            <div class="relative max-w-md w-full bg-white rounded-xl shadow-2xl p-6">
              <button class="absolute top-4 right-4 text-gray-600 hover:text-gray-900 focus:outline-none" id="closeFilterModal">
                <i data-lucide="x" class="h-5 w-5"></i>
              </button>
              <h2 class="text-xl font-medium mb-4">Select Partner Types to Show</h2>
              <div class="space-y-3">
                <label class="flex items-center gap-2 font-medium">
                  <input type="checkbox" id="selectAll" class="h-4 w-4 rounded accent-[#2563eb]" ${allChecked} />
                  Select All
                </label>
                ${checkboxes}
              </div>
              <div class="mt-6 flex justify-end gap-3">
                <button id="resetFilter" class="rounded-full border border-gray-300 px-4 py-2 text-sm hover:bg-gray-50 transition-all duration-300">Reset</button>
                <button id="saveFilter" class="rounded-full bg-[#2563eb] hover:bg-[#1d4ed8] px-4 py-2 text-sm text-white shadow-sm transition-all duration-300">Save</button>
              </div>
            </div>
          </div>
        `;
      }
      function renderPartnerTypeSelector() {
        let options = '';
        STATE.selectedPartnerTypes.forEach((t) => {
          const display = t === "Registered" ? "Registered (LAR/Referral)" : t;
          options += `<option value="${t}" ${STATE.partnerType === t ? 'selected' : ''}>${display}</option>`;
        });
        return `
          <div class="rounded-xl bg-white p-6 shadow-md hover:shadow-lg transition-shadow duration-300">
            <label for="partnerType" class="block text-base font-semibold mb-3">Select Partner Type</label>
            <select id="partnerType" class="w-full rounded-lg border border-[#E2E8F0] bg-white px-4 py-2.5 text-sm focus:border-[#2563eb] focus:ring-2 focus:ring-[#2563eb] focus:ring-opacity-50">
              ${options}
            </select>
          </div>
        `;
      }
      function renderTabs() {
        let tabsHtml = '<div class="overflow-x-auto"><div class="flex space-x-1 rounded-full bg-gray-50 p-1" role="tablist" aria-label="Tabs">';
        TABS.forEach((tab) => {
          const active = STATE.activeTab === tab.id;
          const disabled = (tab.id === 'margins' && !getPartnerData(STATE.partnerType).isStandard) ||
                           (tab.id === 'onboarding' && STATE.partnerType === 'Registered');
          if (!disabled) {
            tabsHtml += `
              <button
                data-tab="${tab.id}"
                class="flex-1 min-w-[120px] whitespace-nowrap py-2 px-4 rounded-full font-medium text-sm flex items-center justify-center gap-2 focus:outline-none focus:ring-2 focus:ring-[#2563eb] focus:ring-offset-2 transition-all duration-300"
                role="tab"
                aria-selected="${active}"
                ${active ? 'bg-[#2563eb] text-white' : 'text-gray-700 hover:bg-gray-200'}
              >
                <i data-lucide="${tab.icon}" class="h-4 w-4 ${active ? 'stroke-white' : 'stroke-gray-600'}"></i>
                ${tab.label}
              </button>
            `;
          }
        });
        tabsHtml += '</div></div>';
        return tabsHtml;
      }
      function renderOverview(overview, showEvaluation) {
        let contentHtml = '<h2 class="text-xl font-medium mb-6 flex items-center gap-3"><i data-lucide="book-open" class="h-6 w-6 stroke-[#2563eb]"></i>Overview</h2>';
        const paragraphs = overview.split('\n\n');
        paragraphs.forEach(para => {
          const lines = para.split('\n');
          if (lines.length > 1 && lines.every(line => line.startsWith('* '))) {
            contentHtml += '<ul class="space-y-4 mt-4">';
            lines.forEach(line => {
              contentHtml += `
                <li class="flex items-start gap-3">
                  <div class="flex-shrink-0 mt-1 bg-[#2563eb] rounded-full p-1">
                    <i data-lucide="check" class="h-3 w-3 stroke-white"></i>
                  </div>
                  <span class="text-gray-700 leading-relaxed">${line.substring(2)}</span>
                </li>
              `;
            });
            contentHtml += '</ul>';
          } else {
            contentHtml += `<p class="text-gray-700 leading-relaxed mb-4">${para.replace(/\n/g, '<br>')}</p>`;
          }
        });
        if (showEvaluation) {
          contentHtml += `
            <button id="evaluationButton" class="mt-6 inline-flex items-center gap-2 rounded-full bg-[#2563eb] hover:bg-[#1d4ed8] px-6 py-2 text-sm text-white shadow-sm focus:outline-none focus:ring-2 focus:ring-[#2563eb] focus:ring-offset-2 transition-all duration-300">
              <i data-lucide="eye" class="h-4 w-4"></i>
              View Preferred vs. Premier Evaluation Guide
            </button>
          `;
        }
        return contentHtml;
      }
      function renderRequirementsAndBenefits(reqs, bens, isPremier) {
        let html = '<h2 class="text-xl font-medium mb-6 flex items-center gap-3"><i data-lucide="check-circle" class="h-6 w-6 stroke-[#2563eb]"></i>Requirements & Benefits</h2>';
        html += '<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">';
        html += '<div>';
        html += '<h3 class="text-xl font-medium mb-4 flex items-center gap-2"><i data-lucide="list" class="h-5 w-5 stroke-[#2563eb]"></i>Requirements</h3>';
        html += '<ul class="space-y-4">';
        reqs.forEach((r) => {
          html += `
            <li class="flex items-start gap-3">
              <div class="flex-shrink-0 mt-1 bg-[#2563eb] rounded-full p-1">
                <i data-lucide="check" class="h-3 w-3 stroke-white"></i>
              </div>
              <span class="text-gray-700 leading-relaxed">${r}</span>
            </li>
          `;
        });
        html += '</ul>';
        if (isPremier) {
          html += `
            <div class="flex flex-col gap-4 mt-6">
              <button id="businessPlanButton" class="inline-flex items-center gap-2 rounded-full bg-[#2563eb] hover:bg-[#1d4ed8] px-6 py-2 text-sm text-white shadow-sm focus:outline-none focus:ring-2 focus:ring-[#2563eb] focus:ring-offset-2 transition-all duration-300">
                <i data-lucide="file-text" class="h-4 w-4"></i>
                Mutual Business Plan
              </button>
              <button id="partnerEventsButton" class="inline-flex items-center gap-2 rounded-full bg-[#2563eb] hover:bg-[#1d4ed8] px-6 py-2 text-sm text-white shadow-sm focus:outline-none focus:ring-2 focus:ring-[#2563eb] focus:ring-offset-2 transition-all duration-300">
                <i data-lucide="calendar" class="h-4 w-4"></i>
                MDF | Joint lead-Gen Example
              </button>
            </div>
          `;
        }
        html += '</div>';
        html += '<div>';
        html += '<h3 class="text-xl font-medium mb-4 flex items-center gap-2"><i data-lucide="gift" class="h-5 w--5 stroke-[#2563eb]"></i>Benefits</h3>';
        html += '<ul class="space-y-4">';
        bens.forEach((b) => {
          html += `
            <li class="flex items-start gap-3">
              <div class="flex-shrink-0 mt-1 bg-[#2563eb] rounded-full p-1">
                <i data-lucide="check" class="h-3 w-3 stroke-white"></i>
              </div>
              <span class="text-gray-700 leading-relaxed">${b}</span>
            </li>
          `;
        });
        html += '</ul>';
        html += '</div>';
        html += '</div>';
        return html;
      }
      function renderMarginsContent() {
        const disabled = STATE.partnerType === "Registered";
        const universe = STATE.model.margins[STATE.commitment][STATE.dealType];
        const key = STATE.partnerType === "Registered" ? "Registered" : "Preferred|Premier";
        const rules = universe[key];
        const fullMarginValue = STATE.partnerType === "Registered" ? "5%" : STATE.commitment === "Annual" ? "30%" : "20%";
        const fullMarginRate = parseFloat(fullMarginValue);
        let html = '<h2 class="text-xl font-medium mb-6 flex items-center gap-3"><i data-lucide="dollar-sign" class="h-6 w-6 stroke-[#2563eb]"></i> Partner Margins</h2>';
        html += '<p class="text-gray-700 mb-6">Based on your <strong>' + STATE.partnerType + '</strong> tier and Band qualification, here\'s a breakdown of your margins and potential services revenue (using a 6:1 multiplier for every $1 in licensing).</p>';
        html += '<div class="flex flex-wrap items-center gap-4 mb-6">';
        html += `<label class="flex items-center gap-3 text-sm font-medium ${disabled ? "opacity-50 cursor-not-allowed" : ""}">
          <input type="checkbox" id="newPartner" class="h-4 w-4 rounded accent-[#2563eb]" ${disabled ? "disabled" : ""} ${STATE.newPartner ? "checked" : ""} />
          New partner boost (first 3 net-new deals)
        </label>`;
        html += '<select id="commitment" class="rounded-lg border border-[#E2E8F0] bg-white px-4 py-2.5 text-sm focus:border-[#2563eb] focus:ring-2 focus:ring-[#2563eb] focus:ring-opacity-50">';
        html += `<option ${STATE.commitment === "Annual" ? "selected" : ""}>Annual</option>`;
        html += `<option ${STATE.commitment === "Monthly" ? "selected" : ""}>Monthly</option>`;
        html += '</select>';
        html += '<select id="dealType" class="rounded-lg border border-[#E2E8F0] bg-white px-4 py-2.5 text-sm focus:border-[#2563eb] focus:ring-2 focus:ring-[#2563eb] focus:ring-opacity-50">';
        html += `<option ${STATE.dealType === "Net New" ? "selected" : ""}>Net New</option>`;
        html += `<option ${STATE.dealType === "Renewal" ? "selected" : ""}>Renewal</option>`;
        html += '</select>';
        html += '<select id="bandSelect" class="rounded-lg border border-[#E2E8F0] bg-white px-4 py-2.5 text-sm focus:border-[#2563eb] focus:ring-2 focus:ring-[#2563eb] focus:ring-opacity-50">';
        ['band1', 'band2', 'band3'].forEach(b => {
          const m = STATE.salesCycle.bandMeta[b];
          html += `<option value="${b}" ${STATE.band === b ? 'selected' : ''}>${m.name}</option>`;
        });
        html += '</select>';
        html += '</div>';
        // Margin Articulation and Examples
        html += '<div class="mb-8">';
        html += '<h3 class="text-lg font-medium mb-4 flex items-center gap-2"><i data-lucide="list" class="h-5 w-5 stroke-[#2563eb]"></i>Margin Breakdown by Band</h3>';
        html += '<div class="overflow-x-auto mb-4">';
        html += '<table class="min-w-full divide-y divide-[#E2E8F0]">';
        html += '<thead><tr><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Band</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Up to</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Qualification</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Example Scenario</th></tr></thead>';
        html += '<tbody class="divide-y divide-[#E2E8F0]">';
        rules.forEach((r) => {
          html += `<tr><td class="px-6 py-4 text-sm font-medium">${r.band}</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">${r.upTo}</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">${r.when}</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">For ${STATE.partnerType}: ${r.band === 'Band 1' ? 'Full ownership yields max margin; e.g., $100K deal = $30K margin.' : r.band === 'Band 2' ? 'Co-sell support; e.g., $100K deal = $15K margin.' : 'Referral only; e.g., $100K deal = $5K margin.'}</td></tr>`;
        });
        html += '</tbody></table></div>';
        html += '<p class="text-xs text-gray-600">“Up to” indicates the maximum eligible margin given qualifiers & program standing.</p>';
        html += '</div>';
        // Calculator as Quote Template
        html += '<div class="mt-8">';
        html += '<h3 class="text-lg font-medium mb-4 flex items-center gap-2"><i data-lucide="calculator" class="h-5 w-5 stroke-[#2563eb]"></i>Example Quote Calculator</h3>';
        html += '<div class="flex items-center gap-4 mb-4">';
        html += '<label for="exampleACV" class="text-sm font-medium">Licensing ACV:</label>';
        html += `<input id="exampleACV" type="number" value="${STATE.exampleACV}" class="w-40 rounded-lg border border-[#E2E8F0] bg-white px-4 py-2.5 text-sm focus:border-[#2563eb] focus:ring-2 focus:ring-[#2563eb] focus:ring-opacity-50">`;
        html += '</div>';
        html += '<div class="grid grid-cols-1 md:grid-cols-2 gap-6">';
        const acv = STATE.exampleACV;
        const servicesRev = acv * STATE.servicesMultiplier;
        if (STATE.newPartner && STATE.dealType === "Net New" && !disabled) {
          const marginAmt = (fullMarginRate / 100) * acv;
          const net = acv - marginAmt;
          html += `
            <div class="rounded-xl border border-[#E2E8F0] p-4 bg-white shadow-md hover:shadow-lg transition-shadow duration-300">
              <h4 class="font-medium mb-2 flex items-center gap-2"><i data-lucide="dollar-sign" class="h-4 w-4 stroke-[#2563eb]"></i>Licensing Items (New Partner Boost - Up to ${fullMarginValue})</h4>
              <ul class="space-y-2 text-sm text-gray-700 leading-relaxed">
                <li><strong>Gross ACV:</strong> $${acv.toLocaleString()}</li>
                <li><strong>Margin Rate:</strong> ${fullMarginRate}%</li>
                <li><strong>Margin Amount:</strong> $${marginAmt.toLocaleString()}</li>
                <li><strong>Net to Recast:</strong> $${net.toLocaleString()}</li>
              </ul>
            </div>
            <div class="rounded-xl border border-[#E2E8F0] p-4 bg-white shadow-md hover:shadow-lg transition-shadow duration-300">
              <h4 class="font-medium mb-2 flex items-center gap-2"><i data-lucide="trending-up" class="h-4 w-4 stroke-[#2563eb]"></i>Potential Services Revenue (6:1 Multiplier)</h4>
              <ul class="space-y-2 text-sm text-gray-700 leading-relaxed">
                <li><strong>Licensing Base:</strong> $${acv.toLocaleString()}</li>
                <li><strong>Multiplier:</strong> 6x</li>
                <li><strong>Total Services:</strong> $${servicesRev.toLocaleString()}</li>
                <li><strong>Example for ${STATE.partnerType}:</strong> ${STATE.partnerType === 'Premier' ? 'High-value managed services like automation and compliance.' : STATE.partnerType === 'Preferred' ? 'Co-sell driven consulting.' : 'Transactional add-ons.'}</li>
              </ul>
            </div>
          `;
        } else {
          rules.forEach((r) => {
            const rate = parseFloat(r.upTo.replace(/[^\d.]/g, ''));
            const marginAmt = (rate / 100) * acv;
            const net = acv - marginAmt;
            html += `
              <div class="rounded-xl border border-[#E2E8F0] p-4 bg-white shadow-md hover:shadow-lg transition-shadow duration-300">
                <h4 class="font-medium mb-2 flex items-center gap-2"><i data-lucide="dollar-sign" class="h-4 w-4 stroke-[#2563eb]"></i>Licensing Items (${r.band} - ${r.upTo})</h4>
                <ul class="space-y-2 text-sm text-gray-700 leading-relaxed">
                  <li><strong>Gross ACV:</strong> $${acv.toLocaleString()}</li>
                  <li><strong>Margin Rate:</strong> ${rate}%</li>
                  <li><strong>Margin Amount:</strong> $${marginAmt.toLocaleString()}</li>
                  <li><strong>Net to Recast:</strong> $${net.toLocaleString()}</li>
                </ul>
              </div>
              <div class="rounded-xl border border-[#E2E8F0] p-4 bg-white shadow-md hover:shadow-lg transition-shadow duration-300">
                <h4 class="font-medium mb-2 flex items-center gap-2"><i data-lucide="trending-up" class="h-4 w-4 stroke-[#2563eb]"></i>Potential Services Revenue (6:1 Multiplier)</h4>
                <ul class="space-y-2 text-sm text-gray-700 leading-relaxed">
                  <li><strong>Licensing Base:</strong> $${acv.toLocaleString()}</li>
                  <li><strong>Multiplier:</strong> 6x</li>
                  <li><strong>Total Services:</strong> $${servicesRev.toLocaleString()}</li>
                  <li><strong>Example for ${STATE.partnerType}:</strong> ${STATE.partnerType === 'Premier' ? 'High-value managed services like automation and compliance.' : STATE.partnerType === 'Preferred' ? 'Co-sell driven consulting.' : 'Transactional add-ons.'}</li>
                </ul>
              </div>
            `;
          });
        }
        html += '</div></div>';
        return html;
      }
      function renderDetailsContent(specific) {
        let html = '<h2 class="text-xl font-medium mb-6 flex items-center gap-3"><i data-lucide="info" class="h-6 w-6 stroke-[#2563eb]"></i>Details</h2>';
        html += '<div class="overflow-x-auto">';
        html += '<table class="min-w-full divide-y divide-[#E2E8F0]">';
        html += '<thead><tr><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Partner Type</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Tier Eligibility</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Margin</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Deal Registration</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">MDF Access</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Enablement</th></tr></thead>';
        html += '<tbody class="divide-y divide-[#E2E8F0]">';
        html += `<tr><td class="px-6 py-4 text-sm font-medium">${specific.partnerType}</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">${specific.tierEligibility}</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">${specific.margin}</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">${specific.dealRegistration}</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">${specific.mdfAccess}</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">${specific.enablement}</td></tr>`;
        html += '</tbody></table></div>';
        return html;
      }
      function renderROEContent() {
        if (STATE.partnerType === 'MSP') {
          return renderROEWithToggle(renderSimpleROE(STATE.partnerType), renderInternalROE());
        }
        return renderROEWithToggle(renderSimpleROE(STATE.partnerType), renderInternalROE());
      }
      function renderROEWithToggle(partnerHtml, internalHtml){
        const toggle = `
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-xl font-medium flex items-center gap-3">
              <i data-lucide="gavel" class="h-6 w-6 stroke-[#2563eb]"></i>Rules of Engagement
            </h2>
            <div class="inline-flex rounded-full bg-gray-100 p-1">
              <button data-roeview="partner" class="px-3 py-1 text-sm rounded-full ${STATE.roeView==='partner'?'bg-white shadow':''}">Partner-facing</button>
              <button data-roeview="internal" class="px-3 py-1 text-sm rounded-full ${STATE.roeView==='internal'?'bg-white shadow':''}">Internal</button>
            </div>
          </div>`;
        const body = STATE.roeView==='partner' ? partnerHtml : internalHtml;
        return toggle + body;
      }
      function renderSimpleROE(type){
        const d = STATE.simpleROE[type];
        const defBand = STATE.defaultBandByType[type] || 'band2';
        const bandMeta = STATE.salesCycle.bandMeta[defBand];
        const card = (title, inner) => `
          <div class="rounded-xl bg-white shadow-md hover:shadow-lg transition overflow-hidden">
            <h3 class="text-lg font-semibold p-5 border-b border-[#E2E8F0] bg-gray-50 flex items-center gap-2">
              <i data-lucide="file-text" class="h-5 w-5 stroke-[#2563eb]"></i>${title}
            </h3>
            <div class="p-5">${inner}</div>
          </div>`;
        const list = (items) => `<ul class="space-y-2">${items.map(i=>`
          <li class="flex items-start gap-3">
            <span class="mt-1 bg-[#2563eb] rounded-full p-1"><i data-lucide="check" class="h-3 w-3 stroke-white"></i></span>
            <span class="text-gray-700 leading-relaxed">${typeof i==='string'?i:`<strong>${i.label}:</strong> ${i.value}`}</span>
          </li>`).join('')}</ul>`;
        const bandsTable = `
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-[#E2E8F0]">
              <thead><tr>
                <th class="px-4 py-2 text-left text-sm font-semibold">Band</th>
                <th class="px-4 py-2 text-left text-sm font-semibold">When</th>
                <th class="px-4 py-2 text-left text-sm font-semibold">Rule</th>
              </tr></thead>
              <tbody class="divide-y divide-[#E2E8F0]">
                ${d.bands.map(b => `
                  <tr>
                    <td class="px-4 py-3 text-sm font-medium">${b.band}</td>
                    <td class="px-4 py-3 text-sm">
                      <ul class="list-disc pl-5 space-y-1">${(b.when||[]).map(w=>`<li>${w}</li>`).join('')}</ul>
                    </td>
                    <td class="px-4 py-3 text-sm">${b.rule||''}</td>
                  </tr>`).join('')}
              </tbody>
            </table>
          </div>`;
        const csvBlock = `
          <p class="text-gray-700 leading-relaxed mb-3">${d.csv.blurb}</p>
          <div class="grid md:grid-cols-3 gap-4">
            <div><div class="font-medium mb-1">Required Columns</div>${list(d.csv.required)}</div>
            <div><div class="font-medium mb-1">What Happens</div>${list(d.csv.flow)}</div>
            <div class="flex items-start">
              <button id="csvSopBtn" class="rounded-full bg-[#2563eb] hover:bg-[#1d4ed8] px-4 py-2 text-sm text-white shadow-sm">CSV Upload SOP</button>
            </div>
          </div>`;
        if (type === 'Registered') {
          const principlesTable = `
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-[#E2E8F0]">
                <thead><tr>
                  <th class="px-4 py-2 text-left text-sm font-semibold">Principle</th>
                  <th class="px-4 py-2 text-left text-sm font-semibold">Description</th>
                  <th class="px-4 py-2 text-left text-sm font-semibold">Intent</th>
                </tr></thead>
                <tbody class="divide-y divide-[#E2E8F0]">
                  ${d.roePrinciples.map(p => `
                    <tr>
                      <td class="px-4 py-3 text-sm font-medium">${p.principle}</td>
                      <td class="px-4 py-3 text-sm">${p.description}</td>
                      <td class="px-4 py-3 text-sm">${p.intent}</td>
                    </tr>`).join('')}
                </tbody>
              </table>
            </div>`;
          const marginBandsTable = `
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-[#E2E8F0]">
                <thead><tr>
                  <th class="px-4 py-2 text-left text-sm font-semibold">Band</th>
                  <th class="px-4 py-2 text-left text-sm font-semibold">Qualification Criteria</th>
                  <th class="px-4 py-2 text-left text-sm font-semibold">Eligible Partner Type</th>
                  <th class="px-4 py-2 text-left text-sm font-semibold">Margin (Up To)</th>
                  <th class="px-4 py-2 text-left text-sm font-semibold">Example</th>
                </tr></thead>
                <tbody class="divide-y divide-[#E2E8F0]">
                  ${d.marginBands.map(b => `
                    <tr>
                      <td class="px-4 py-3 text-sm font-medium">${b.band}</td>
                      <td class="px-4 py-3 text-sm">${b.criteria}</td>
                      <td class="px-4 py-3 text-sm">${b.eligible}</td>
                      <td class="px-4 py-3 text-sm">${b.margin}</td>
                      <td class="px-4 py-3 text-sm">${b.example}</td>
                    </tr>`).join('')}
                </tbody>
              </table>
            </div>`;
          return `
            <div class="space-y-6">
              <div class="flex flex-wrap items-center gap-2">
                <span class="px-3 py-1 text-xs rounded-2xl ${bandMeta.color}">${bandMeta.name}</span>
                <span class="text-xs text-gray-600">Default expectation for ${type}</span>
              </div>
              ${card("Sourcing & Attribution", list(d.sourcing))}
              ${card("Rules of Engagement", principlesTable)}
              ${card("Margin Band Table", marginBandsTable)}
              ${card("Renewals", list(d.renewals))}
              ${card("Uploading Event/Co-Marketing Leads", csvBlock)}
            </div>`;
        } else {
          return `
            <div class="space-y-6">
              <div class="flex flex-wrap items-center gap-2">
                <span class="px-3 py-1 text-xs rounded-2xl ${bandMeta.color}">${bandMeta.name}</span>
                <span class="text-xs text-gray-600">Default expectation for ${type}</span>
              </div>
              ${card("Sourcing & Attribution", list(d.sourcing))}
              ${card("Registration Bands (What You Earn)", bandsTable)}
              ${card("Renewals", list(d.renewals))}
              ${card("Uploading Event/Co-Marketing Leads", csvBlock)}
            </div>`;
        }
      }
      function renderInternalROE(){
        if (STATE.partnerType === 'MSP') {
          let html = '<ol class="space-y-6 list-decimal pl-6">';
          STATE.msp.roe.forEach(rule => {
            html += `<li class="text-gray-700 leading-relaxed">${rule.replace(/\n/g, '<br>')}</li>`;
          });
          html += '</ol>';
          return html;
        } else {
          let html = '<div class="space-y-6">';
          html += renderROESection('Rules of Engagement (ROE)', renderPrinciplesTable());
          html += renderROESection('Margin Bands & Definitions', renderBandsTable());
          html += renderROESection('Partner Margin Governance', renderGovernanceTable());
          html += renderROESection('Example Summary Table', renderSummaryTable());
          html += '</div>';
          return html;
        }
      }
      function renderROESection(title, tableHtml) {
        return `
          <div class="rounded-xl bg-white shadow-md hover:shadow-lg transition-shadow duration-300 overflow-hidden">
            <h3 class="text-lg font-semibold p-5 border-b border-[#E2E8F0] flex items-center gap-2 bg-gray-50"><i data-lucide="file-text" class="h-5 w-5 stroke-[#2563eb]"></i>${title}</h3>
            <div class="overflow-x-auto">${tableHtml}</div>
          </div>
        `;
      }
      function renderPrinciplesTable() {
        let html = '<table class="min-w-full divide-y divide-[#E2E8F0]"><thead><tr><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Principle</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Description</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Intent</th></tr></thead><tbody class="divide-y divide-[#E2E8F0]">';
        STATE.model.roe.principles.forEach((p) => {
          html += `<tr><td class="px-6 py-4 text-sm font-medium">${p.principle}</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">${p.description}</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">${p.intent}</td></tr>`;
        });
        html += '</tbody></table>';
        return html;
      }
      function renderBandsTable() {
        let html = '<table class="min-w-full divide-y divide-[#E2E8F0]"><thead><tr><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Band</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Qualification Criteria</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Partner Type Eligible</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Margin (up to)</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Example Scenario</th></tr></thead><tbody class="divide-y divide-[#E2E8F0]">';
        STATE.model.roe.bands.forEach((b) => {
          let criteriaHtml = '<ul class="list-disc pl-5 space-y-1">';
          b.criteria.forEach((c) => { criteriaHtml += `<li class="text-sm text-gray-700 leading-relaxed">${c}</li>`; });
          criteriaHtml += '</ul>';
          html += `<tr><td class="px-6 py-4 text-sm font-medium">${b.band}</td><td class="px-6 py-4">${criteriaHtml}</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">${b.eligible}</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">${b.margin}</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">${b.example}</td></tr>`;
        });
        html += '</tbody></table>';
        return html;
      }
      function renderGovernanceTable() {
        let html = '<table class="min-w-full divide-y divide-[#E2E8F0]"><thead><tr><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Element</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Definition</th></tr></thead><tbody class="divide-y divide-[#E2E8F0]">';
        STATE.model.roe.governance.forEach((g) => {
          html += `<tr><td class="px-6 py-4 text-sm font-medium">${g.element}</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">${g.definition}</td></tr>`;
        });
        html += '</tbody></table>';
        return html;
      }
      function renderSummaryTable() {
        let html = '<table class="min-w-full divide-y divide-[#E2E8F0]"><thead><tr><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Partner Tier</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Engagement Type</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Typical Recast Involvement</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Margin Range</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Notes</th></tr></thead><tbody class="divide-y divide-[#E2E8F0]">';
        STATE.model.roe.summary.forEach((s) => {
          html += `<tr><td class="px-6 py-4 text-sm font-medium">${s.tier}</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">${s.engagement}</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">${s.involvement}</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">${s.range}</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">${s.notes}</td></tr>`;
        });
        html += '</tbody></table>';
        return html;
      }
      function renderSalesMotionContent() {
        let html = '<h2 class="text-xl font-medium mb-6 flex items-center gap-3"><i data-lucide="table" class="h-6 w-6 stroke-[#2563eb]"></i>Sales Motion</h2>';
        html += '<div class="flex flex-col gap-4 md:flex-row md:items-end md:justify-between mb-4">';
        html += '<div><p class="text-base text-gray-700 leading-relaxed mt-1">View the sales cycle matrix showing stages, ownership, support, exit criteria, and deliverables based on the selected band.</p></div>';
        if (STATE.partnerType !== 'Registered') {
          html += '<select id="bandSelect" class="w-[280px] rounded-lg border border-[#E2E8F0] bg-white px-4 py-2.5 text-sm focus:border-[#2563eb] focus:ring-2 focus:ring-[#2563eb] focus:ring-opacity-50">';
          ['band1', 'band2', 'band3'].forEach(b => {
            const m = STATE.salesCycle.bandMeta[b];
            html += `<option value="${b}" ${STATE.band === b ? 'selected' : ''}>${m.name}</option>`;
          });
          html += '</select>';
        } else {
          STATE.band = 'band3';
          html += '<p class="text-base text-gray-700 leading-relaxed mt-1">For Registered (LAR/Referral) partners, only Band 3 (Transactional / Referral) applies.</p>';
        }
        html += '</div>';
        const meta = STATE.salesCycle.bandMeta[STATE.band];
        html += '<div class="flex flex-wrap items-center gap-3 mb-6">';
        html += `<span class="px-3 py-1 text-xs rounded-2xl ${meta.color}">${meta.name}</span>`;
        html += '</div>';
        html += '<div class="space-y-4">';
        STATE.salesCycle.rows.forEach(key => {
          const stage = STATE.salesCycle.stages[key];
          const own = STATE.salesCycle.bands[STATE.band][key];
          html += '<div class="rounded-xl bg-white p-4 shadow-md border border-[#E2E8F0] hover:shadow-lg transition-shadow duration-300">';
          html += '<h3 class="text-lg font-semibold mb-1">' + stage.label + '</h3>';
          html += '<p class="text-xs text-gray-700 leading-relaxed mb-4">' + stage.description + '</p>';
          html += '<div class="grid grid-cols-1 md:grid-cols-3 gap-4">';
          html += '<div class="bg-gray-50 rounded-xl p-3">';
          html += '<div class="font-medium text-sm mb-1 flex items-center gap-2"><i data-lucide="user-round" class="h-4 w-4 stroke-[#2563eb]"></i>Owner</div>';
          html += '<div class="text-sm">' + own.primaryOwner + '</div>';
          html += '<div class="text-[11px] text-gray-600 mt-0.5">Accountable: ' + own.accountable + '</div>';
          html += '</div>';
          html += '<div class="bg-gray-50 rounded-xl p-3">';
          html += '<div class="font-medium text-sm mb-1 flex items-center gap-2"><i data-lucide="users-round" class="h-4 w-4 stroke-[#2563eb]"></i>Support</div>';
          html += '<div class="flex flex-wrap gap-1">';
          own.support.forEach(s => {
            html += '<span class="rounded-full bg-white px-2 py-0.5 text-xs text-gray-600 border border-[#E2E8F0]">' + s + '</span>';
          });
          html += '</div></div>';
          html += '<div class="bg-gray-50 rounded-xl p-3">';
          html += '<div class="font-medium text-sm mb-1 flex items-center gap-2"><i data-lucide="check-circle" class="h-4 w-4 stroke-[#2563eb]"></i>Exit Criteria</div>';
          html += '<ul class="list-disc pl-4 space-y-0.5 text-xs text-gray-700 leading-relaxed">';
          stage.exitCriteria.forEach(e => { html += '<li>' + e + '</li>'; });
          html += '</ul></div>';
          html += '</div></div>';
        });
        html += '</div>';
        html += '<div class="mt-6 text-xs text-gray-600 flex flex-wrap gap-4">';
        html += '<span class="flex items-center gap-1"><i data-lucide="handshake" class="h-3 w-3 stroke-[#2563eb]"></i>Band 1 rewards full-cycle ownership</span>';
        html += '<span class="flex items-center gap-1"><i data-lucide="users-round" class="h-3 w-3 stroke-[#2563eb]"></i> Band 2 is co-sell</span>';
        html += '<span class="flex items-center gap-1"><i data-lucide="shield-check" class="h-3 w-3 stroke-[#2563eb]"></i> Band 3 is referral/transactional</span>';
        html += '</div>';
        html += '<div class="mt-4 rounded-xl border border-[#E2E8F0] p-4 bg-gray-50 flex gap-3 items-start">';
        html += '<i data-lucide="info" class="h-5 w-5 mt-0.5 stroke-[#2563eb]"></i>';
        html += '<div><div class="font-medium">Lead Registration & Partner of Record</div><p class="text-gray-700 leading-relaxed text-sm mt-1">A lead is not considered Partner of Record until approved by Recast through the Partner Portal. Margin eligibility is set at deal approval based on documented ownership and CRM evidence.</p></div>';
        html += '</div>';
        return html;
      }
      function renderOnboardingContent(data) {
        let html = '<h2 class="text-xl font-medium mb-6 flex items-center gap-3"><i data-lucide="rocket" class="h-6 w-6 stroke-[#2563eb]"></i>Onboarding Requirements</h2>';
        let certHtml = '<div class="rounded-xl bg-amber-100 border border-amber-200 p-4 mb-6">';
        certHtml += '<h3 class="text-lg font-medium mb-2 flex items-center gap-2"><i data-lucide="award" class="h-5 w-5 stroke-[#d97706]"></i>Required Certifications</h3>';
        let certText;
        if (STATE.partnerType === 'MSP') {
          certText = 'Initial sales and technical certifications for eligible product lines.';
        } else if (STATE.partnerType === 'Preferred') {
          certText = '1 Certified Sales resource and 1 Certified Technical resource.';
        } else if (STATE.partnerType === 'Premier') {
          certText = 'Certified sales and technical resources (minimum 2 each recommended).';
        } else {
          certText = 'Customized onboarding based on GTM motion; must complete GTM certification.';
        }
        certHtml += `<p class="text-gray-700 leading-relaxed">For ${STATE.partnerType} partners: ${certText} These must be completed during the initial onboarding phase before advancing and accessing full partner benefits, resources, and margin eligibility.</p>`;
        certHtml += '</div>';
        html += certHtml;
        if (data.isStandard) {
          const steps = STATE.model.onboarding.steps;
          let buttonsHtml = '<div class="flex flex-wrap gap-3 mb-6">';
          steps.forEach((s, i) => {
            const active = STATE.activeStep === i;
            buttonsHtml += `
              <button
                data-step="${i}"
                class="${active ? 'bg-[#2563eb] text-white' : 'bg-white text-gray-700 hover:bg-gray-100'} inline-flex items-center gap-2 rounded-full px-5 py-2.5 text-sm font-medium transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-[#2563eb] focus:ring-offset-2"
              >
                <i data-lucide="${active ? 'check-circle' : 'circle'}" class="h-4 w-4"></i>
                ${s.name}
              </button>
            `;
          });
          buttonsHtml += '</div>';
          const items = steps[STATE.activeStep].items;
          let listHtml = '<ul class="space-y-4">';
          items.forEach((item) => {
            listHtml += `
              <li class="flex items-start gap-3">
                <div class="flex-shrink-0 mt-1 bg-[#2563eb] rounded-full p-1">
                  <i data-lucide="check" class="h-3 w-3 stroke-white"></i>
                </div>
                <span class="text-gray-700 leading-relaxed">${item}</span>
              </li>
            `;
          });
          listHtml += '</ul>';
          html += buttonsHtml + listHtml;
        } else if (STATE.partnerType === 'MSP') {
          html += '<h3 class="text-xl font-medium mb-4">Onboarding Steps:</h3>';
          html += '<ol class="space-y-4 list-decimal pl-6">';
          STATE.msp.onboarding.steps.forEach(s => {
            html += `<li class="text-gray-700 leading-relaxed">${s.replace(/\n/g, '<br>')}</li>`;
          });
          html += '</ol>';
          html += '<h3 class="text-xl font-medium mt-8 mb-4">Resources Provided:</h3>';
          html += '<ul class="space-y-4">';
          STATE.msp.onboarding.resources.forEach(r => {
            html += `
              <li class="flex items-start gap-3">
                <div class="flex-shrink-0 mt-1 bg-[#2563eb] rounded-full p-1">
                  <i data-lucide="check" class="h-3 w-3 stroke-white"></i>
                </div>
                <span class="text-gray-700 leading-relaxed">${r}</span>
              </li>
            `;
          });
          html += '</ul>';
        } else {
          // For OEM, ISV, Distributor - already handled in certHtml
        }
        return html;
      }
      function renderBusinessPlanModal() {
        return `
          <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 px-4" role="dialog" aria-modal="true" id="businessPlanModal">
            <div class="relative max-w-4xl w-full bg-white rounded-xl shadow-2xl p-8 max-h-[90vh] overflow-y-auto">
              <button class="absolute top-4 right-4 text-gray-600 hover:text-gray-900 focus:outline-none" id="closeBusinessPlan">
                <i data-lucide="x" class="h-6 w-6"></i>
                <span class="sr-only">Close</span>
              </button>
              <h2 class="text-xl font-medium mb-6 flex items-center gap-3"><i data-lucide="file-text" class="h-6 w-6 stroke-[#2563eb]"></i>Partner Business Plan</h2>
              <p class="text-center font-semibold mb-8 text-gray-700 leading-relaxed">Recast Software + CoreSecure Systems</p>
              ${renderBusinessPlanContent()}
            </div>
          </div>
        `;
      }
      function renderPartnerEventsModal() {
        return `
          <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 px-4" role="dialog" aria-modal="true" id="partnerEventsModal">
            <div class="relative max-w-4xl w-full bg-white rounded-xl shadow-2xl p-8 max-h-[90vh] overflow-y-auto">
              <button class="absolute top-4 right-4 text-gray-600 hover:text-gray-900 focus:outline-none" id="closePartnerEvents">
                <i data-lucide="x" class="h-6 w-6"></i>
                <span class="sr-only">Close</span>
              </button>
              <h2 class="text-xl font-medium mb-4 flex items-center gap-3"><i data-lucide="calendar" class="h-6 w-6 stroke-[#2563eb]"></i>Joint Marketing Campaigns Success</h2>
              <p class="text-gray-700 leading-relaxed mb-6">Our team excels at driving demand gen through co-marketing events. We're particularly strong in webinars, user groups, events/happy hours, and partner events. Example Avg. </p>
              <div class="overflow-x-auto mb-8">
                <table class="min-w-full divide-y divide-[#E2E8F0]">
                  <thead>
                    <tr>
                      <th class="px-6 py-3 text-left text-sm font-semibold">Type</th>
                      <th class="px-6 py-3 text-left text-sm font-semibold"># Events</th>
                      <th class="px-6 py-3 text-left text-sm font-semibold">Avg Invited</th>
                      <th class="px-6 py-3 text-left text-sm font-semibold">Avg Attended</th>
                      <th class="px-6 py-3 text-left text-sm font-semibold">Avg Opps</th>
                      <th class="px-6 py-3 text-left text-sm font-semibold">Avg Opp % (Invited)</th>
                      <th class="px-6 py-3 text-left text-sm font-semibold">Avg Opp % (Attended)</th>
                      <th class="px-6 py-3 text-left text-sm font-semibold">Avg Closed Won</th>
                      <th class="px-6 py-3 text-left text-sm font-semibold">Win %</th>
                    </tr>
                  </thead>
                  <tbody class="divide-y divide-[#E2E8F0]">
                    ${STATE.partnerEvents.summaries.map(s => `
                      <tr>
                        <td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">${s.type}</td>
                        <td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">${s.events}</td>
                        <td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">${s.avgInvited}</td>
                        <td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">${s.avgAttended}</td>
                        <td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">${s.avgOpps}</td>
                        <td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">${s.avgOppInvited}</td>
                        <td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">${s.avgOppAttended}</td>
                        <td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">${s.avgClosed}</td>
                        <td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">${s.win}</td>
                      </tr>
                    `).join('')}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        `;
      }
      function renderBusinessPlanContent() {
        let html = '';
        html += '<section class="mb-8">';
        html += '<h3 class="text-xl font-medium mb-4">1. EXECUTIVE SUMMARY</h3>';
        html += '<h4 class="text-lg font-medium mb-2">Vision</h4>';
        html += '<p class="text-gray-700 leading-relaxed mb-4">To jointly deliver intelligent, automated application and endpoint management solutions for enterprise customers in regulated industries by integrating Recast’s Application Workspace into CoreSecure’s managed compliance platform.</p>';
        html += '<h4 class="text-lg font-medium mb-2">Strategic Goals</h4>';
        html += '<ul class="space-y-3 mb-4">';
        html += '<li class="flex items-start gap-3"><div class="flex-shrink-0 mt-1 bg-[#2563eb] rounded-full p-1"><i data-lucide="check" class="h-3 w-3 stroke-white"></i></div><span class="text-gray-700 leading-relaxed">Expand joint enterprise footprint across Financial Services and Healthcare.</span></li>';
        html += '<li class="flex items-start gap-3"><div class="flex-shrink-0 mt-1 bg-[#2563eb] rounded-full p-1"><i data-lucide="check" class="h-3 w-3 stroke-white"></i></div><span class="text-gray-700 leading-relaxed">Increase Recast ARR by 60% year-over-year through CoreSecure-led managed services.</span></li>';
        html += '<li class="flex items-start gap-3"><div class="flex-shrink-0 mt-1 bg-[#2563eb] rounded-full p-1"><i data-lucide="check" class="h-3 w-3 stroke-white"></i></div><span class="text-gray-700 leading-relaxed">Position CoreSecure as a fully certified Premier MSP across Application Workspace and Access Manager.</span></li>';
        html += '</ul>';
        html += '<h4 class="text-lg font-medium mb-2">Mutual Value</h4>';
        html += '<ul class="space-y-3">';
        html += '<li class="flex items-start gap-3"><div class="flex-shrink-0 mt-1 bg-[#2563eb] rounded-full p-1"><i data-lucide="check" class="h-3 w-3 stroke-white"></i></div><span class="text-gray-700 leading-relaxed">For CoreSecure: Differentiation through integrated automation and compliance reporting, driving new managed service revenue.</span></li>';
        html += '<li class="flex items-start gap-3"><div class="flex-shrink-0 mt-1 bg-[#2563eb] rounded-full p-1"><i data-lucide="check" class="h-3 w-3 stroke-white"></i></div><span class="text-gray-700 leading-relaxed">For Recast: Accelerated customer acquisition, deeper retention, and expansion into managed environments at scale.</span></li>';
        html += '</ul>';
        html += '</section>';
        html += '<section class="mb-8">';
        html += '<h3 class="text-xl font-medium mb-4">2. PARTNERSHIP OBJECTIVES</h3>';
        html += '<div class="overflow-x-auto">';
        html += '<table class="min-w-full divide-y divide-[#E2E8F0]">';
        html += '<thead><tr><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Focus Area</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">FY26 Goal</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Success Metric</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Owner</th></tr></thead>';
        html += '<tbody class="divide-y divide-[#E2E8F0]">';
        html += '<tr><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Enablement</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Complete certification program for sales and technical teams</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">4 technical + 2 sales certifications completed</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Partner Enablement Lead</td></tr>';
        html += '<tr><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Demand Generation</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Execute two co-branded campaigns per quarter</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">8 total campaigns</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Recast & Partner Marketing</td></tr>';
        html += '<tr><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Revenue Growth</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Build $1.2M Recast ARR pipeline</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">50% partner-led, 50% co-sell</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Partner Sales Director</td></tr>';
        html += '<tr><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Operational Excellence</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Streamline joint onboarding and renewals</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed"><30-day deployment cycle</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Recast CS & Partner Ops</td></tr>';
        html += '</tbody></table></div>';
        html += '</section>';
        html += '<section class="mb-8">';
        html += '<h3 class="text-xl font-medium mb-4">3. ENABLEMENT PLAN</h3>';
        html += '<div class="overflow-x-auto">';
        html += '<table class="min-w-full divide-y divide-[#E2E8F0]">';
        html += '<thead><tr><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Activity</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Timing</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Notes / CTA</th></tr></thead>';
        html += '<tbody class="divide-y divide-[#E2E8F0]">';
        html += '<tr><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Sales Certification (Recast Academy)</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">January–February</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Enroll 2 CoreSecure sales reps</td></tr>';
        html += '<tr><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Technical Certification (Workspace Delivery)</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">February–March</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Conduct hands-on enablement with Recast SE</td></tr>';
        html += '<tr><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Demo Environment Setup</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">March</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Deploy joint demo tenant for App Workspace</td></tr>';
        html += '<tr><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Partner Portal Access</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">April</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Activate CoreSecure in Recast portal with CRM integration</td></tr>';
        html += '<tr><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">QBR Framework Implementation</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">April</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Define performance metrics and success tracking</td></tr>';
        html += '</tbody></table></div>';
        html += '</section>';
        html += '<section class="mb-8">';
        html += '<h3 class="text-xl font-medium mb-4">4. LEADS & DEAL REGISTRATION</h3>';
        html += '<div class="overflow-x-auto">';
        html += '<table class="min-w-full divide-y divide-[#E2E8F0]">';
        html += '<thead><tr><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Activity</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Timing</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Notes / CTA</th></tr></thead>';
        html += '<tbody class="divide-y divide-[#E2E8F0]">';
        html += '<tr><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Salesforce integration and Partner of Record mapping</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">January</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Confirm partner setup for deal registration</td></tr>';
        html += '<tr><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Register 5 qualified leads per quarter</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Quarterly</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Minimum deal size $25K ACV</td></tr>';
        html += '<tr><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Weekly pipeline sync</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Ongoing</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Partner + Recast Channel Manager review</td></tr>';
        html += '<tr><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Pre-sales and SE support request process</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">As needed</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Submit via Partner Portal form</td></tr>';
        html += '</tbody></table></div>';
        html += '</section>';
        html += '<section class="mb-8">';
        html += '<h3 class="text-xl font-medium mb-4">5. 12-MONTH PLAN: DEMAND GENERATION</h3>';
        html += '<div class="overflow-x-auto">';
        html += '<table class="min-w-full divide-y divide-[#E2E8F0]">';
        html += '<thead><tr><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Activity</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Month</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Notes / CTA</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Anticipated Spend</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Target Leads</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Conversion Rate</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Closed Revenue Outcome</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Services Outcome</th></tr></thead>';
        html += '<tbody class="divide-y divide-[#E2E8F0]">';
        html += '<tr><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Co-branded Webinar: “Automating Intune Compliance”</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">February</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Target Financial Services IT leaders</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">$3,000</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">50</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">10%</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">$75,000</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">$20,000</td></tr>';
        html += '<tr><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Customer Case Study</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">April</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">CoreSecure + BankOne success story</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">$2,000</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">N/A</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">N/A</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">$0</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Brand lift</td></tr>';
        html += '<tr><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Regional Executive Roundtable</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">June</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Invite-only event in Chicago</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">$5,000</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">30</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">15%</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">$100,000</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">$30,000</td></tr>';
        html += '<tr><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">LinkedIn Ad Campaign</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">August</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">6-week campaign targeting enterprise MSPs</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">$6,000</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">100</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">8%</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">$96,000</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">$15,000</td></tr>';
        html += '<tr><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Year-End “Partner Powered” Webinar</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">November</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Highlight joint wins and prep renewals</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">$2,500</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">40</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">10%</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">$60,000</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">$10,000</td></tr>';
        html += '<tr><td class="px-6 py-4 text-sm font-medium">Totals</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed"></td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed"></td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">$18,500</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">220</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">11% (avg)</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">$331,000</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">$75,000</td></tr>';
        html += '</tbody></table></div>';
        html += '</section>';
        html += '<section class="mb-8">';
        html += '<h3 class="text-xl font-medium mb-4">6. QBR & EXECUTIVE ALIGNMENT</h3>';
        html += '<h4 class="text-lg font-medium mb-2">Initial QBR:</h4>';
        html += '<ul class="space-y-3 mb-4">';
        html += '<li class="flex items-start gap-3"><div class="flex-shrink-0 mt-1 bg-[#2563eb] rounded-full p-1"><i data-lucide="check" class="h-3 w-3 stroke-white"></i></div><span class="text-gray-700 leading-relaxed">Date: January 15</span></li>';
        html += '<li class="flex items-start gap-3"><div class="flex-shrink-0 mt-1 bg-[#2563eb] rounded-full p-1"><i data-lucide="check" class="h-3 w-3 stroke-white"></i></div><span class="text-gray-700 leading-relaxed">Topics: FY26 enablement baseline, pipeline setup, campaign calendar</span></li>';
        html += '</ul>';
        html += '<h4 class="text-lg font-medium mb-2">Quarterly QBR Schedule:</h4>';
        html += '<div class="overflow-x-auto">';
        html += '<table class="min-w-full divide-y divide-[#E2E8F0]">';
        html += '<thead><tr><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Quarter</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Month</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Key Focus</th></tr></thead>';
        html += '<tbody class="divide-y divide-[#E2E8F0]">';
        html += '<tr><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Q1</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">March</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Certification completion and first pipeline review</td></tr>';
        html += '<tr><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Q2</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">June</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Marketing ROI and new logo acquisition</td></tr>';
        html += '<tr><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Q3</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">September</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Expansion and renewals</td></tr>';
        html += '<tr><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Q4</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">December</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Annual review and FY27 planning</td></tr>';
        html += '</tbody></table></div>';
        html += '</section>';
        html += '<section class="mb-8">';
        html += '<h3 class="text-xl font-medium mb-4">7. QBR TEMPLATE</h3>';
        html += '<div class="overflow-x-auto">';
        html += '<table class="min-w-full divide-y divide-[#E2E8F0]">';
        html += '<thead><tr><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Section</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">ContentExample</th></tr></thead>';
        html += '<tbody class="divide-y divide-[#E2E8F0]">';
        html += '<tr><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Executive Summary</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Pipeline, ARR growth, key wins, challenges</td></tr>';
        html += '<tr><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Enablement Progress</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Certifications completed, demo environment status</td></tr>';
        html += '<tr><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Pipeline Review</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Opportunity stages, close rates, forecast accuracy</td></tr>';
        html += '<tr><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Co-Marketing Performance</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Campaign reach, leads generated, ROI</td></tr>';
        html += '<tr><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Customer Success</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Renewals, expansion accounts, support metrics</td></tr>';
        html += '<tr><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Action Items</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Next steps, owners, and deadlines</td></tr>';
        html += '</tbody></table></div>';
        html += '</section>';
        html += '<section>';
        html += '<h3 class="text-xl font-medium mb-4">8. KEY CONTACTS</h3>';
        html += '<div class="overflow-x-auto">';
        html += '<table class="min-w-full divide-y divide-[#E2E8F0]">';
        html += '<thead><tr><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Role</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">Recast Software</th><th scope="col" class="px-6 py-3 text-left text-sm font-semibold">CoreSecure Systems</th></tr></thead>';
        html += '<tbody class="divide-y divide-[#E2E8F0]">';
        html += '<tr><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Channel Director</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Jane Smith</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Michael Reed</td></tr>';
        html += '<tr><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Partner Manager</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Alex Nguyen</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Sarah Lopez</td></tr>';
        html += '<tr><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Sales Engineer</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">David Patel</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Andrew Clarke</td></tr>';
        html += '<tr><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Marketing Lead</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Laura Chen</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Olivia Ruiz</td></tr>';
        html += '<tr><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Customer Success Manager</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Tom Williams</td><td class="px-6 py-4 text-sm text-gray-700 leading-relaxed">Rachel Kim</td></tr>';
        html += '</tbody></table></div>';
        html += '</section>';
        return html;
      }
      function renderEvaluationModal() {
        return `
          <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 px-4" role="dialog" aria-modal="true" id="evaluationModal">
            <div class="relative max-w-3xl w-full bg-white rounded-xl shadow-2xl p-8 max-h-[90vh] overflow-y-auto">
              <button class="absolute top-4 right-4 text-gray-600 hover:text-gray-900 focus:outline-none" id="closeEvaluation">
                <i data-lucide="x" class="h-6 w-6"></i>
                <span class="sr-only">Close</span>
              </button>
              <h2 class="text-xl font-medium mb-6 flex items-center gap-3"><i data-lucide="scale" class="h-6 w-6 stroke-[#2563eb]"></i>Preferred vs. Premier Partner Evaluation Guide</h2>
              ${renderEvaluationGuideContent()}
            </div>
          </div>
        `;
      }
      function renderEvaluationGuideContent() {
        let html = '';
        html += '<p class="text-gray-700 leading-relaxed mb-6">When evaluating whether a Preferred Partner is ready to advance to Premier status, Recast looks at three key areas — Focus, Capability, and Commitment.<br>These criteria ensure we’re investing in partners that can truly scale with us, represent our brand effectively, and deliver measurable revenue outcomes.</p>';
        html += '<section class="mb-6">';
        html += '<h3 class="text-xl font-medium mb-3 flex items-center gap-2"><i data-lucide="target" class="h-5 w-5 stroke-[#2563eb]"></i>1. Focus — Are they aligned with Recast’s go-to-market direction?</h3>';
        html += '<p class="text-gray-700 leading-relaxed mb-4">We assess whether the partner’s business focus and customer base align with the markets and segments Recast wants to grow in.</p>';
        html += '<ul class="space-y-3">';
        html += '<li class="flex items-start gap-3"><div class="flex-shrink-0 mt-1 bg-[#2563eb] rounded-full p-1"><i data-lucide="check" class="h-3 w-3 stroke-white"></i></div><span class="text-gray-700 leading-relaxed">Do they specialize in the right customer segment (e.g., enterprise, mid-market, or public sector)?</span></li>';
        html += '<li class="flex items-start gap-3"><div class="flex-shrink-0 mt-1 bg-[#2563eb] rounded-full p-1"><i data-lucide="check" class="h-3 w-3 stroke-white"></i></div><span class="text-gray-700 leading-relaxed">Are they active in the industries or regions where Recast wants to expand?</span></li>';
        html += '<li class="flex items-start gap-3"><div class="flex-shrink-0 mt-1 bg-[#2563eb] rounded-full p-1"><i data-lucide="check" class="h-3 w-3 stroke-white"></i></div><span class="text-gray-700 leading-relaxed">Do they have core competencies that complement Recast’s product strengths (endpoint management, automation, workspace delivery, etc.)?</span></li>';
        html += '<li class="flex items-start gap-3"><div class="flex-shrink-0 mt-1 bg-[#2563eb] rounded-full p-1"><i data-lucide="check" class="h-3 w-3 stroke-white"></i></div><span class="text-gray-700 leading-relaxed">Are they targeting the functional buyers that align with Recast’s motion (IT Ops, Security, Endpoint, Workspace)?</span></li>';
        html += '</ul>';
        html += '</section>';
        html += '<section class="mb-6">';
        html += '<h3 class="text-xl font-medium mb-3 flex items-center gap-2"><i data-lucide="bar-chart" class="h-5 w-5 stroke-[#2563eb]"></i>2. Capability — Do they have the structure to scale with Recast?</h3>';
        html += '<p class="text-gray-700 leading-relaxed mb-4">We evaluate whether the partner has the resources, skills, and reach to build and grow a sustainable Recast practice.</p>';
        html += '<ul class="space-y-3">';
        html += '<li class="flex items-start gap-3"><div class="flex-shrink-0 mt-1 bg-[#2563eb] rounded-full p-1"><i data-lucide="check" class="h-3 w-3 stroke-white"></i></div><span class="text-gray-700 leading-relaxed">Do they have technical resources trained or able to support Recast deployments?</span></li>';
        html += '<li class="flex items-start gap-3"><div class="flex-shrink-0 mt-1 bg-[#2563eb] rounded-full p-1"><i data-lucide="check" class="h-3 w-3 stroke-white"></i></div><span class="text-gray-700 leading-relaxed">Do they have a dedicated sales team capable of positioning and selling Recast solutions?</span></li>';
        html += '<li class="flex items-start gap-3"><div class="flex-shrink-0 mt-1 bg-[#2563eb] rounded-full p-1"><i data-lucide="check" class="h-3 w-3 stroke-white"></i></div><span class="text-gray-700 leading-relaxed">Is there a marketing function that can run co-branded or joint campaigns?</span></li>';
        html += '<li class="flex items-start gap-3"><div class="flex-shrink-0 mt-1 bg-[#2563eb] rounded-full p-1"><i data-lucide="check" class="h-3 w-3 stroke-white"></i></div><span class="text-gray-700 leading-relaxed">Do they have customer reach in the accounts and regions Recast wants to penetrate?</span></li>';
        html += '<li class="flex items-start gap-3"><div class="flex-shrink-0 mt-1 bg-[#2563eb] rounded-full p-1"><i data-lucide="check" class="h-3 w-3 stroke-white"></i></div><span class="text-gray-700 leading-relaxed">Are they geographically positioned in areas where Recast needs stronger coverage?</span></li>';
        html += '</ul>';
        html += '</section>';
        html += '<section>';
        html += '<h3 class="text-xl font-medium mb-3 flex items-center gap-2"><i data-lucide="handshake" class="h-5 w-5 stroke-[#2563eb]"></i>3. Commitment — Are they invested in mutual growth and measurable results?</h3>';
        html += '<p class="text-gray-700 leading-relaxed mb-4">We confirm that the partner isn’t just opportunistic, but strategically committed to driving joint revenue and customer success.</p>';
        html += '<ul class="space-y-3">';
        html += '<li class="flex items-start gap-3"><div class="flex-shrink-0 mt-1 bg-[#2563eb] rounded-full p-1"><i data-lucide="check" class="h-3 w-3 stroke-white"></i></div><span class="text-gray-700 leading-relaxed">Have they committed to a defined revenue target or growth goal for Recast?</span></li>';
        html += '<li class="flex items-start gap-3"><div class="flex-shrink-0 mt-1 bg-[#2563eb] rounded-full p-1"><i data-lucide="check" class="h-3 w-3 stroke-white"></i></div><span class="text-gray-700 leading-relaxed">Are they showing year-over-year progress in pipeline creation and customer adoption?</span></li>';
        html += '<li class="flex items-start gap-3"><div class="flex-shrink-0 mt-1 bg-[#2563eb] rounded-full p-1"><i data-lucide="check" class="h-3 w-3 stroke-white"></i></div><span class="text-gray-700 leading-relaxed">Are they actively pursuing upsell, cross-sell, and expansion within existing customers?</span></li>';
        html += '<li class="flex items-start gap-3"><div class="flex-shrink-0 mt-1 bg-[#2563eb] rounded-full p-1"><i data-lucide="check" class="h-3 w-3 stroke-white"></i></div><span class="text-gray-700 leading-relaxed">Do they have joint business plans or defined KPIs aligned with Recast’s objectives?</span></li>';
        html += '<li class="flex items-start gap-3"><div class="flex-shrink-0 mt-1 bg-[#2563eb] rounded-full p-1"><i data-lucide="check" class="h-3 w-3 stroke-white"></i></div><span class="text-gray-700 leading-relaxed">Are they investing in training, enablement, and certification to build long-term capability?</span></li>';
        html += '</ul>';
        html += '</section>';
        return html;
      }
      function renderCsvModal(){
        const sample = "Partner Name,Campaign Name,Account Name,Domain,First Name,Last Name,Email,Country,Source Type,Attribution Intent,Requested PoR\nAcme Partner,2025-03 Webinar,Contoso,contoso.com,Jane,Doe,jane@contoso.com,US,Webinar,Partner Sourced,Yes";
        return `
        <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 px-4" id="csvModal">
          <div class="relative max-w-3xl w-full bg-white rounded-xl shadow-2xl p-8 max-h-[90vh] overflow-y-auto">
            <button class="absolute top-4 right-4 text-gray-600 hover:text-gray-900" id="closeCsvModal"><i data-lucide="x" class="h-6 w-6"></i></button>
            <h2 class="text-xl font-medium mb-4 flex items-center gap-3"><i data-lucide="upload" class="h-6 w-6 stroke-[#2563eb]"></i>CSV Upload SOP</h2>
            <ol class="list-decimal pl-6 space-y-2 text-gray-700">
              <li>Download the template CSV.</li>
              <li>Fill required columns; one row per contact.</li>
              <li>Choose “Create Deal Registration” for qualified rows.</li>
              <li>Channel approves within 2 business days (PoR + Band applied).</li>
            </ol>
            <div class="mt-4">
              <pre class="bg-gray-50 p-3 rounded-lg text-xs overflow-auto">${sample}</pre>
            </div>
            <div class="mt-4 flex gap-2">
              <button class="rounded-full bg-[#2563eb] text-white px-4 py-2 text-sm" id="downloadCsvTpl">Download Template</button>
              <button class="rounded-full border px-4 py-2 text-sm" id="closeCsvModal2">Close</button>
            </div>
          </div>
        </div>`;
      }
      function addEventListeners() {
        document.getElementById('partnerType').addEventListener('change', (e) => {
          STATE.partnerType = e.target.value;
          STATE.band = setDefaultBand(STATE.partnerType);
          if (STATE.partnerType === 'Registered') {
            STATE.newPartner = false;
            if (['margins', 'onboarding'].includes(STATE.activeTab)) {
              STATE.activeTab = 'overview';
            }
          } else if (!getPartnerData(STATE.partnerType).isStandard && STATE.activeTab === 'margins') {
            STATE.activeTab = 'overview';
          }
          render();
        });
        document.querySelectorAll('[data-tab]').forEach((btn) => {
          btn.addEventListener('click', () => {
            STATE.activeTab = btn.dataset.tab;
            render();
          });
        });
        const newPartnerCheckbox = document.getElementById('newPartner');
        if (newPartnerCheckbox) {
          newPartnerCheckbox.addEventListener('change', (e) => {
            STATE.newPartner = e.target.checked;
            render();
          });
        }
        const commitmentSelect = document.getElementById('commitment');
        if (commitmentSelect) {
          commitmentSelect.addEventListener('change', (e) => {
            STATE.commitment = e.target.value;
            render();
          });
        }
        const dealTypeSelect = document.getElementById('dealType');
        if (dealTypeSelect) {
          dealTypeSelect.addEventListener('change', (e) => {
            STATE.dealType = e.target.value;
            render();
          });
        }
        const bandSelect = document.getElementById('bandSelect');
        if (bandSelect) {
          bandSelect.addEventListener('change', (e) => {
            STATE.band = e.target.value;
            render();
          });
        }
        document.querySelectorAll('[data-step]').forEach((btn) => {
          btn.addEventListener('click', () => {
            STATE.activeStep = parseInt(btn.dataset.step);
            render();
          });
        });
        const businessPlanButton = document.getElementById('businessPlanButton');
        if (businessPlanButton) {
          businessPlanButton.addEventListener('click', () => {
            STATE.showBusinessPlanModal = true;
            render();
          });
        }
        const partnerEventsButton = document.getElementById('partnerEventsButton');
        if (partnerEventsButton) {
          partnerEventsButton.addEventListener('click', () => {
            STATE.showPartnerEventsModal = true;
            render();
          });
        }
        const evaluationButton = document.getElementById('evaluationButton');
        if (evaluationButton) {
          evaluationButton.addEventListener('click', () => {
            STATE.showEvaluationModal = true;
            render();
          });
        }
        const closeBusinessPlan = document.getElementById('closeBusinessPlan');
        if (closeBusinessPlan) {
          closeBusinessPlan.addEventListener('click', () => {
            STATE.showBusinessPlanModal = false;
            render();
          });
        }
        const closePartnerEvents = document.getElementById('closePartnerEvents');
        if (closePartnerEvents) {
          closePartnerEvents.addEventListener('click', () => {
            STATE.showPartnerEventsModal = false;
            render();
          });
        }
        const closeEvaluation = document.getElementById('closeEvaluation');
        if (closeEvaluation) {
          closeEvaluation.addEventListener('click', () => {
            STATE.showEvaluationModal = false;
            render();
          });
        }
        const exampleACVInput = document.getElementById('exampleACV');
        if (exampleACVInput) {
          exampleACVInput.addEventListener('input', (e) => {
            STATE.exampleACV = parseFloat(e.target.value) || 100000;
            render();
          });
        }
        document.querySelectorAll('[data-roeview]').forEach(btn=>{
          btn.addEventListener('click',()=>{
            STATE.roeView = btn.dataset.roeview;
            render();
          });
        });
        const csvBtn = document.getElementById('csvSopBtn');
        if (csvBtn){
          csvBtn.addEventListener('click',()=>{
            STATE.showCsvModal = true;
            render();
          });
        }
        const closeCsv = document.getElementById('closeCsvModal');
        const closeCsv2 = document.getElementById('closeCsvModal2');
        if (closeCsv || closeCsv2){
          [closeCsv, closeCsv2].filter(Boolean).forEach(b=>b.addEventListener('click',()=>{ STATE.showCsvModal=false; render(); }));
        }
        const dl = document.getElementById('downloadCsvTpl');
        if (dl){
          dl.addEventListener('click',()=>{
            const csv = `Partner Name,Campaign Name,Account Name,Domain,First Name,Last Name,Email,Country,Source Type,Attribution Intent,Requested PoR\n`;
            const blob = new Blob([csv], {type:'text/csv'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href=url; a.download='recast_partner_upload_template.csv'; a.click();
            URL.revokeObjectURL(url);
          });
        }
        const filterTrigger = document.getElementById('filterTrigger');
        if (filterTrigger) {
          filterTrigger.addEventListener('change', (e) => {
            STATE.filterModalOpen = e.target.checked;
            render();
          });
        }
        const selectAll = document.getElementById('selectAll');
        if (selectAll) {
          selectAll.addEventListener('change', (e) => {
            if (e.target.checked) {
              STATE.selectedPartnerTypes = PARTNER_TYPES.slice();
            } else {
              STATE.selectedPartnerTypes = [];
            }
            render();
          });
        }
        document.querySelectorAll('.partner-type-checkbox').forEach(cb => {
          cb.addEventListener('change', (e) => {
            const type = e.target.dataset.type;
            if (e.target.checked) {
              if (!STATE.selectedPartnerTypes.includes(type)) {
                STATE.selectedPartnerTypes.push(type);
              }
            } else {
              STATE.selectedPartnerTypes = STATE.selectedPartnerTypes.filter(t => t !== type);
            }
            render();
          });
        });
        const saveFilter = document.getElementById('saveFilter');
        if (saveFilter) {
          saveFilter.addEventListener('click', () => {
            if (STATE.selectedPartnerTypes.length === 0) {
              STATE.selectedPartnerTypes = PARTNER_TYPES.slice();
            }
            if (typeof localStorage !== 'undefined') {
              localStorage.setItem('recastPartnerTypeFilter', JSON.stringify({ selectedPartnerTypes: STATE.selectedPartnerTypes }));
            }
            STATE.filterModalOpen = false;
            render();
          });
        }
        const resetFilter = document.getElementById('resetFilter');
        if (resetFilter) {
          resetFilter.addEventListener('click', () => {
            STATE.selectedPartnerTypes = PARTNER_TYPES.slice();
            if (typeof localStorage !== 'undefined') {
              localStorage.setItem('recastPartnerTypeFilter', JSON.stringify({ selectedPartnerTypes: STATE.selectedPartnerTypes }));
            }
            STATE.filterModalOpen = false;
            render();
          });
        }
        const closeFilterModal = document.getElementById('closeFilterModal');
        if (closeFilterModal) {
          closeFilterModal.addEventListener('click', () => {
            STATE.filterModalOpen = false;
            render();
          });
        }
        const filterModalBg = document.getElementById('filterModalBg');
        if (filterModalBg) {
          filterModalBg.addEventListener('click', (e) => {
            if (e.target === filterModalBg) {
              STATE.filterModalOpen = false;
              render();
            }
          });
        }
        const modals = document.querySelectorAll('#businessPlanModal, #partnerEventsModal, #evaluationModal, #csvModal');
        modals.forEach(m => {
          m.addEventListener('click', (e) => {
            if (e.target === m) {
              STATE.showBusinessPlanModal = false;
              STATE.showPartnerEventsModal = false;
              STATE.showEvaluationModal = false;
              STATE.showCsvModal = false;
              render();
            }
          });
        });
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && (STATE.showBusinessPlanModal || STATE.showPartnerEventsModal || STATE.showEvaluationModal || STATE.showCsvModal || STATE.filterModalOpen)) {
            STATE.showBusinessPlanModal = false;
            STATE.showPartnerEventsModal = false;
            STATE.showEvaluationModal = false;
            STATE.showCsvModal = false;
            STATE.filterModalOpen = false;
            render();
          }
        });
      }
      document.addEventListener('DOMContentLoaded', () => {
        initFilter();
        render();
      });
    </script>
  </body>
</html>
